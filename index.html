<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì§ì›ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
:root{
  --p:#2563eb;--pd:#1d4ed8;--pl:#eff6ff;
  --s:#16a34a;--sl:#f0fdf4;
  --d:#dc2626;--dl:#fef2f2;
  --w:#d97706;--wl:#fffbeb;
  --g0:#ffffff;--g50:#f9fafb;--g100:#f3f4f6;--g200:#e5e7eb;--g300:#d1d5db;
  --g400:#9ca3af;--g500:#6b7280;--g600:#4b5563;--g700:#374151;--g800:#1f2937;
  --sh:0 1px 3px rgba(0,0,0,.1);--shm:0 4px 6px rgba(0,0,0,.07);--shl:0 10px 15px rgba(0,0,0,.1);
  --r:8px;--rl:12px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Noto Sans KR',sans-serif;background:var(--g50);color:var(--g800);font-size:14px}

/* â”€â”€ ì¸ì¦ â”€â”€ */
#auth{display:none;position:fixed;inset:0;background:linear-gradient(135deg,#1e3a8a,#2563eb);z-index:9999;align-items:center;justify-content:center}
#auth.on{display:flex}
.ab{background:var(--g0);border-radius:var(--rl);padding:40px;width:400px;box-shadow:var(--shl)}
.al{text-align:center;margin-bottom:28px}
.al h1{font-size:22px;font-weight:700;margin-top:8px}
.al p{font-size:13px;color:var(--g400);margin-top:4px}
.atabs{display:flex;border-bottom:2px solid var(--g200);margin-bottom:24px}
.atab{flex:1;padding:10px;text-align:center;font-size:14px;font-weight:500;color:var(--g400);cursor:pointer;border:none;background:none;font-family:inherit;transition:.2s}
.atab.on{color:var(--p);border-bottom:2px solid var(--p);margin-bottom:-2px}
.af{display:none}.af.on{display:block}
.fl{margin-bottom:16px}
.fl label{display:block;font-size:13px;font-weight:500;color:var(--g600);margin-bottom:6px}
.fl input{width:100%;padding:10px 12px;border:1px solid var(--g300);border-radius:var(--r);font-size:14px;font-family:inherit;outline:none;transition:.2s}
.fl input:focus{border-color:var(--p);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
.bfull{width:100%;padding:11px;background:var(--p);color:white;border:none;border-radius:var(--r);font-size:15px;font-weight:600;font-family:inherit;cursor:pointer;margin-top:4px;transition:.2s}
.bfull:hover{background:var(--pd)}
.bfull:disabled{background:var(--g300);cursor:not-allowed}
.msg{font-size:13px;margin-top:12px;padding:10px 12px;border-radius:var(--r);display:none}
.msg.err{display:block;background:var(--dl);color:var(--d)}
.msg.ok{display:block;background:var(--sl);color:var(--s)}

/* â”€â”€ ë¡œë”© ìŠ¤í”¼ë„ˆ â”€â”€ */
.spin{display:inline-block;width:16px;height:16px;border:2px solid var(--g200);border-top-color:var(--p);border-radius:50%;animation:sp .6s linear infinite;vertical-align:middle;margin-right:6px}
@keyframes sp{to{transform:rotate(360deg)}}
.loading-full{display:flex;align-items:center;justify-content:center;padding:60px;color:var(--g400);font-size:14px}

/* â”€â”€ í—¤ë” â”€â”€ */
#hdr{background:var(--g0);border-bottom:1px solid var(--g200);padding:0 24px;display:flex;align-items:center;justify-content:space-between;height:56px;position:sticky;top:0;z-index:100;box-shadow:0 1px 2px rgba(0,0,0,.05)}
.logo{font-size:18px;font-weight:700;color:var(--p);display:flex;align-items:center;gap:8px}
.hright{display:flex;align-items:center;gap:12px}
.un{font-size:14px;font-weight:500;color:var(--g700)}
.ub{font-size:11px;padding:2px 8px;border-radius:99px;font-weight:600}
.ub.admin{background:#fef3c7;color:#92400e}
.ub.user{background:var(--pl);color:var(--pd)}
.hbtn{padding:7px 14px;border-radius:var(--r);font-size:13px;font-weight:500;cursor:pointer;font-family:inherit;border:1px solid var(--g300);background:var(--g0);color:var(--g600);transition:.15s}
.hbtn:hover{background:var(--g50)}

/* â”€â”€ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ â”€â”€ */
.refresh-bar{background:var(--pl);border-bottom:1px solid var(--g200);padding:6px 24px;display:flex;align-items:center;justify-content:space-between;font-size:12px;color:var(--pd)}
.rbtn{padding:4px 12px;border-radius:var(--r);font-size:12px;font-weight:500;cursor:pointer;font-family:inherit;border:1px solid var(--p);background:var(--p);color:white;transition:.15s}
.rbtn:hover{background:var(--pd)}

/* â”€â”€ ë„¤ë¹„ â”€â”€ */
#nav{background:var(--g0);border-bottom:1px solid var(--g200);padding:0 24px;display:flex;gap:4px}
.nb{padding:14px 16px;font-size:13px;font-weight:500;color:var(--g500);border:none;background:none;cursor:pointer;border-bottom:2px solid transparent;transition:.2s;font-family:inherit;display:flex;align-items:center;gap:4px}
.nb:hover{color:var(--p)}
.nb.on{color:var(--p);border-bottom-color:var(--p)}
.nbadge{display:inline-flex;align-items:center;justify-content:center;background:var(--d);color:white;font-size:10px;font-weight:700;min-width:16px;height:16px;border-radius:99px;padding:0 4px}

/* â”€â”€ ë©”ì¸ â”€â”€ */
#main{padding:24px;max-width:1200px;margin:0 auto}
.pg{display:none}.pg.on{display:block}

/* â”€â”€ ë²„íŠ¼ â”€â”€ */
.btn{padding:8px 16px;border-radius:var(--r);font-size:13px;font-weight:500;cursor:pointer;border:none;font-family:inherit;transition:.15s;display:inline-flex;align-items:center;gap:6px}
.bp{background:var(--p);color:white}.bp:hover{background:var(--pd)}
.bs{background:var(--s);color:white}.bs:hover{background:#15803d}
.bd{background:var(--d);color:white}.bd:hover{background:#b91c1c}
.bo{background:var(--g0);color:var(--g600);border:1px solid var(--g300)}.bo:hover{background:var(--g50)}
.bsm{padding:5px 10px;font-size:12px}
.btn:disabled{opacity:.5;cursor:not-allowed}

/* â”€â”€ ì¹´ë“œ â”€â”€ */
.card{background:var(--g0);border-radius:var(--rl);border:1px solid var(--g200);padding:20px;box-shadow:var(--sh)}
.ct{font-size:15px;font-weight:600;color:var(--g800);margin-bottom:16px}

/* â”€â”€ ëŒ€ì‹œë³´ë“œ â”€â”€ */
.dg{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
.dc{background:var(--g0);border-radius:var(--rl);border:1px solid var(--g200);padding:20px;box-shadow:var(--sh);transition:.2s}
.dc:hover{box-shadow:var(--shm);transform:translateY(-1px)}
.dc .lb{font-size:12px;color:var(--g400);font-weight:500;text-transform:uppercase;letter-spacing:.5px}
.dc .nm{font-size:32px;font-weight:700;color:var(--g800);margin:8px 0 4px}
.dc .sb{font-size:12px;color:var(--g400)}
.dc.bl{border-top:3px solid var(--p)}
.dc.gr{border-top:3px solid var(--s)}
.dc.or{border-top:3px solid var(--w)}
.dc.re{border-top:3px solid var(--d)}

/* â”€â”€ í…Œì´ë¸” â”€â”€ */
.tw{overflow-x:auto}
table{width:100%;border-collapse:collapse}
th{padding:10px 14px;text-align:left;font-size:12px;font-weight:600;color:var(--g500);text-transform:uppercase;letter-spacing:.4px;border-bottom:1px solid var(--g200);background:var(--g50)}
td{padding:12px 14px;border-bottom:1px solid var(--g100);font-size:13px;color:var(--g700)}
tr:last-child td{border-bottom:none}
tr:hover td{background:var(--g50)}

/* â”€â”€ ë±ƒì§€ â”€â”€ */
.badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:99px;font-size:11px;font-weight:600}
.bbl{background:var(--pl);color:var(--pd)}
.bgr{background:var(--sl);color:var(--s)}
.brd{background:var(--dl);color:var(--d)}
.byw{background:var(--wl);color:var(--w)}
.bgy{background:var(--g100);color:var(--g600)}

/* â”€â”€ í¼ â”€â”€ */
.fg{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.fi{display:flex;flex-direction:column;gap:6px}
.fi label{font-size:13px;font-weight:500;color:var(--g600)}
.fi input,.fi select,.fi textarea{padding:9px 12px;border:1px solid var(--g300);border-radius:var(--r);font-size:13px;font-family:inherit;color:var(--g800);outline:none;transition:.2s}
.fi input:focus,.fi select:focus,.fi textarea:focus{border-color:var(--p);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
.fi.full{grid-column:1/-1}

/* â”€â”€ ëª¨ë‹¬ â”€â”€ */
.mo{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:1000;align-items:center;justify-content:center}
.mo.on{display:flex}
.mb{background:var(--g0);border-radius:var(--rl);width:560px;max-width:95vw;max-height:90vh;overflow-y:auto;box-shadow:var(--shl)}
.mh{padding:20px 24px;border-bottom:1px solid var(--g200);display:flex;align-items:center;justify-content:space-between}
.mh h3{font-size:16px;font-weight:600}
.mc{padding:24px}
.mf{padding:16px 24px;border-top:1px solid var(--g200);display:flex;justify-content:flex-end;gap:8px}
.mx{background:none;border:none;cursor:pointer;color:var(--g400);font-size:22px;padding:0 4px;line-height:1}
.mx:hover{color:var(--g700)}

/* â”€â”€ íˆ´ë°” â”€â”€ */
.tb{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:12px}
.tbl{display:flex;align-items:center;gap:8px}
.si{padding:8px 12px;border:1px solid var(--g300);border-radius:var(--r);font-size:13px;font-family:inherit;width:220px;outline:none}
.si:focus{border-color:var(--p)}

/* â”€â”€ ë¹ˆ ìƒíƒœ â”€â”€ */
.empty{text-align:center;padding:48px 20px;color:var(--g400)}
.empty .ico{font-size:36px;margin-bottom:10px}
.empty p{font-size:13px}

/* â”€â”€ ì—°ì°¨ ë°” â”€â”€ */
.lbw{background:var(--g100);border-radius:99px;height:8px;overflow:hidden;width:80px}
.lbb{height:100%;border-radius:99px}

/* â”€â”€ ê´€ë¦¬ì ëŒ€ê¸° â”€â”€ */
.pi{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border:1px solid var(--g200);border-radius:var(--r);margin-bottom:8px;background:var(--wl)}

@media(max-width:768px){
  .dg{grid-template-columns:1fr 1fr}
  .fg{grid-template-columns:1fr}
  #main{padding:16px}
}
</style>
</head>
<body>

<!-- ì¸ì¦ -->
<div id="auth" class="on">
  <div class="ab">
    <div class="al">
      <div style="font-size:36px">ğŸ¢</div>
      <h1>ì§ì›ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
      <p>Employee Management System</p>
    </div>
    <div class="atabs">
      <button class="atab on" onclick="switchTab('login')">ë¡œê·¸ì¸</button>
      <button class="atab" onclick="switchTab('reg')">íšŒì›ê°€ì…</button>
    </div>
    <div id="fLogin" class="af on">
      <div class="fl"><label>ì•„ì´ë””</label><input id="lId" placeholder="ì•„ì´ë””" onkeydown="if(event.key==='Enter')doLogin()"></div>
      <div class="fl"><label>ë¹„ë°€ë²ˆí˜¸</label><input id="lPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" onkeydown="if(event.key==='Enter')doLogin()"></div>
      <div id="lMsg" class="msg"></div>
      <button class="bfull" id="lBtn" onclick="doLogin()">ë¡œê·¸ì¸</button>
    </div>
    <div id="fReg" class="af">
      <div class="fl"><label>ì´ë¦„</label><input id="rName" placeholder="ì´ë¦„"></div>
      <div class="fl"><label>ì•„ì´ë”” (4ì ì´ìƒ)</label><input id="rId" placeholder="ì•„ì´ë””"></div>
      <div class="fl"><label>ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)</label><input id="rPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"></div>
      <div class="fl"><label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label><input id="rPw2" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥"></div>
      <div id="rMsg" class="msg"></div>
      <button class="bfull" id="rBtn" onclick="doRegister()">íšŒì›ê°€ì… ì‹ ì²­</button>
    </div>
  </div>
</div>

<!-- í—¤ë” -->
<header id="hdr" style="display:none">
  <div class="logo">ğŸ¢ ì§ì›ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
  <div class="hright">
    <span class="un" id="hName"></span>
    <span class="ub" id="hBadge"></span>
    <button class="hbtn" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
</header>

<!-- ìƒˆë¡œê³ ì¹¨ ì•ˆë‚´ë°” -->
<div class="refresh-bar" id="refreshBar" style="display:none">
  ğŸ“¡ ë°ì´í„°ëŠ” ë¡œê·¸ì¸ ì‹œ 1íšŒ ë¡œë“œë©ë‹ˆë‹¤. ë‹¤ë¥¸ ê¸°ê¸°ì˜ ë³€ê²½ì‚¬í•­ì„ ë³´ë ¤ë©´ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.
  <button class="rbtn" onclick="reloadData()">ğŸ”„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
</div>

<!-- ë„¤ë¹„ -->
<nav id="nav" style="display:none">
  <button class="nb on" onclick="go('dash',this)">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
  <button class="nb" onclick="go('emp',this)">ğŸ‘¥ ì§ì›ê´€ë¦¬</button>
  <button class="nb" id="nLeave" onclick="go('leave',this)" style="display:none">ğŸ“… ì—°ì°¨ê´€ë¦¬</button>
  <button class="nb" onclick="go('edu',this)">ğŸ“š ì§ë¬´êµìœ¡</button>
  <button class="nb" onclick="go('backup',this)">ğŸ’¾ ë°±ì—…ê´€ë¦¬</button>
  <button class="nb" id="nAdmin" onclick="go('admin',this)" style="display:none">ğŸ›¡ï¸ ê´€ë¦¬ì<span class="nbadge" id="pbadge" style="display:none">0</span></button>
</nav>

<!-- ë©”ì¸ -->
<main id="main" style="display:none">

  <!-- ëŒ€ì‹œë³´ë“œ -->
  <div id="p-dash" class="pg on">
    <div class="dg">
      <div class="dc bl"><div class="lb">ì „ì²´ ì§ì›</div><div class="nm" id="dTotal">0</div><div class="sb">ëª… ë“±ë¡ë¨</div></div>
      <div class="dc gr"><div class="lb">ì¬ì§ ì§ì›</div><div class="nm" id="dActive">0</div><div class="sb">ëª… ì¬ì§ì¤‘</div></div>
      <div class="dc or"><div class="lb">í‡´ì‚¬ ì§ì›</div><div class="nm" id="dInactive">0</div><div class="sb">ëª… í‡´ì‚¬</div></div>
      <div class="dc re"><div class="lb">ì´ë²ˆë‹¬ ìƒì¼</div><div class="nm" id="dBday">0</div><div class="sb">ëª…</div></div>
    </div>
    <div class="card"><div class="ct">ğŸ“‹ ìµœê·¼ ë“±ë¡ ì§ì›</div><div id="dRecent"></div></div>
  </div>

  <!-- ì§ì›ê´€ë¦¬ -->
  <div id="p-emp" class="pg">
    <div class="card">
      <div class="tb">
        <div class="tbl"><input class="si" id="empQ" placeholder="ğŸ” ì´ë¦„, ë¶€ì„œ, ì§ì±…..." oninput="renderEmp()"></div>
        <button class="btn bp" onclick="openEmpMo()">+ ì§ì› ë“±ë¡</button>
      </div>
      <div class="tw"><table>
        <thead><tr><th>ì´ë¦„</th><th>ë¶€ì„œ</th><th>ì§ì±…</th><th>ì…ì‚¬ì¼</th><th>ì „í™”ë²ˆí˜¸</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead>
        <tbody id="empTb"></tbody>
      </table></div>
    </div>
  </div>

  <!-- ì—°ì°¨ê´€ë¦¬ -->
  <div id="p-leave" class="pg">
    <div class="card">
      <div class="tb">
        <div class="tbl">
          <label style="font-size:13px;font-weight:500;color:var(--g600)">íšŒê³„ì—°ë„</label>
          <select id="leaveYr" style="padding:7px 10px;border:1px solid var(--g300);border-radius:var(--r);font-family:inherit;font-size:13px" onchange="renderLeave()"></select>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn bo" onclick="openBulkMo()">ì¼ê´„ ì—°ì°¨ ì§€ê¸‰</button>
          <button class="btn bp" onclick="openLeaveMo()">+ ì—°ì°¨ ì¶”ê°€</button>
        </div>
      </div>
      <div class="tw"><table>
        <thead><tr><th>ì§ì›</th><th>ë¶€ì„œ</th><th>ì´ ì—°ì°¨</th><th>ì‚¬ìš©</th><th>ì”ì—¬</th><th>ì‚¬ìš©ë¥ </th><th>ê´€ë¦¬</th></tr></thead>
        <tbody id="leaveTb"></tbody>
      </table></div>
    </div>
  </div>

  <!-- ì§ë¬´êµìœ¡ -->
  <div id="p-edu" class="pg">
    <div class="card">
      <div class="tb">
        <div class="tbl"><input class="si" id="eduQ" placeholder="ğŸ” ì§ì›ëª…, êµìœ¡ëª…..." oninput="renderEdu()"></div>
        <button class="btn bp" onclick="openEduMo()">+ êµìœ¡ ì¶”ê°€</button>
      </div>
      <div class="tw"><table>
        <thead><tr><th>ì§ì›</th><th>êµìœ¡ëª…</th><th>êµìœ¡ì¼</th><th>ìˆ˜ë£Œì¦</th><th>ë‹¤ìŒêµìœ¡ì¼</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead>
        <tbody id="eduTb"></tbody>
      </table></div>
    </div>
  </div>

  <!-- ë°±ì—…ê´€ë¦¬ -->
  <div id="p-backup" class="pg">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
      <div class="card">
        <div class="ct">ğŸ’¾ ë°ì´í„° í˜„í™©</div>
        <div style="display:flex;flex-direction:column;gap:10px">
          <div style="display:flex;justify-content:space-between;padding:10px;background:var(--g50);border-radius:var(--r)"><span style="color:var(--g600)">ì „ì²´ ì§ì›</span><strong id="bkE">0ëª…</strong></div>
          <div style="display:flex;justify-content:space-between;padding:10px;background:var(--g50);border-radius:var(--r)"><span style="color:var(--g600)">ì—°ì°¨ ë°ì´í„°</span><strong id="bkL">0ê±´</strong></div>
          <div style="display:flex;justify-content:space-between;padding:10px;background:var(--g50);border-radius:var(--r)"><span style="color:var(--g600)">êµìœ¡ ì¼ì •</span><strong id="bkEd">0ê±´</strong></div>
        </div>
      </div>
      <div class="card">
        <div class="ct">âš¡ ë¹ ë¥¸ ì‘ì—…</div>
        <div style="display:flex;flex-direction:column;gap:10px">
          <button class="btn bp" style="justify-content:center" onclick="dlBackup()">ğŸ’¾ ë°±ì—… ë‹¤ìš´ë¡œë“œ</button>
          <label style="display:flex;align-items:center;justify-content:center;gap:6px;padding:8px 16px;border-radius:var(--r);font-size:13px;font-weight:500;cursor:pointer;border:1px solid var(--g300);background:var(--g0);color:var(--g600)">
            ğŸ“‚ ë°±ì—… ë¶ˆëŸ¬ì˜¤ê¸°<input type="file" accept=".json" onchange="restoreBackup(event)" style="display:none">
          </label>
        </div>
        <p style="font-size:12px;color:var(--d);margin-top:12px">âš ï¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹œ í˜„ì¬ ë°ì´í„°ê°€ ëª¨ë‘ êµì²´ë©ë‹ˆë‹¤</p>
      </div>
    </div>
  </div>

  <!-- ê´€ë¦¬ì -->
  <div id="p-admin" class="pg">
    <div class="card" style="margin-bottom:16px">
      <div class="ct">â³ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ íšŒì›</div>
      <div id="pList"></div>
    </div>
    <div class="card" style="margin-bottom:16px">
      <div class="ct">ğŸ‘¥ ì „ì²´ íšŒì› ëª©ë¡</div>
      <div class="tw"><table><thead><tr><th>ì´ë¦„</th><th>ì•„ì´ë””</th><th>ìƒíƒœ</th><th>ê°€ì…ì¼</th><th>ê´€ë¦¬</th></tr></thead><tbody id="uTb"></tbody></table></div>
    </div>
    <div class="card">
      <div class="ct">ğŸ”‘ ê´€ë¦¬ì ê³„ì • ë³€ê²½</div>
      <div class="fg">
        <div class="fi"><label>ìƒˆ ì•„ì´ë”” (ë¹„ì›Œë‘ë©´ ìœ ì§€)</label><input id="aNewId" placeholder="ë³€ê²½í•  ì•„ì´ë””"></div>
        <div class="fi"><label>í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ *</label><input id="aCurPw" type="password" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸"></div>
        <div class="fi"><label>ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ë¹„ì›Œë‘ë©´ ìœ ì§€)</label><input id="aNewPw" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸"></div>
        <div class="fi"><label>ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label><input id="aNewPw2" type="password"></div>
      </div>
      <div style="margin-top:16px"><button class="btn bp" onclick="updateAdmin()">ê³„ì • ì—…ë°ì´íŠ¸</button></div>
    </div>
  </div>

</main>

<!-- ì§ì› ëª¨ë‹¬ -->
<div id="moEmp" class="mo">
  <div class="mb">
    <div class="mh"><h3 id="moEmpT">ì§ì› ë“±ë¡</h3><button class="mx" onclick="closeMo('moEmp')">Ã—</button></div>
    <div class="mc"><div class="fg">
      <div class="fi"><label>ì´ë¦„ *</label><input id="eName" placeholder="í™ê¸¸ë™"></div>
      <div class="fi"><label>ë¶€ì„œ *</label><input id="eDept" placeholder="ê°œë°œíŒ€"></div>
      <div class="fi"><label>ì§ì±… *</label><input id="ePos" placeholder="ì‚¬ì›"></div>
      <div class="fi"><label>ì…ì‚¬ì¼ *</label><input type="date" id="eJoin"></div>
      <div class="fi"><label>ì „í™”ë²ˆí˜¸</label><input id="ePhone" placeholder="010-0000-0000"></div>
      <div class="fi"><label>ìƒë…„ì›”ì¼</label><input type="date" id="eBirth"></div>
      <div class="fi"><label>ì´ë©”ì¼</label><input type="email" id="eEmail"></div>
      <div class="fi"><label>í‡´ì‚¬ì¼</label><input type="date" id="eResign"></div>
      <div class="fi full"><label>ë©”ëª¨</label><textarea id="eMemo" rows="2" style="resize:vertical" placeholder="íŠ¹ì´ì‚¬í•­"></textarea></div>
    </div></div>
    <div class="mf"><button class="btn bo" onclick="closeMo('moEmp')">ì·¨ì†Œ</button><button class="btn bp" id="empSaveBtn" onclick="saveEmp()">ì €ì¥</button></div>
  </div>
</div>

<!-- ì—°ì°¨ ëª¨ë‹¬ -->
<div id="moLeave" class="mo">
  <div class="mb">
    <div class="mh"><h3>ì—°ì°¨ ì¶”ê°€/ìˆ˜ì •</h3><button class="mx" onclick="closeMo('moLeave')">Ã—</button></div>
    <div class="mc"><div class="fg">
      <div class="fi"><label>ì§ì› *</label><select id="lvEmp"><option value="">ì§ì› ì„ íƒ</option></select></div>
      <div class="fi"><label>íšŒê³„ì—°ë„ *</label><input type="number" id="lvYr"></div>
      <div class="fi"><label>ì´ ì—°ì°¨ì¼ìˆ˜ *</label><input type="number" id="lvTotal" placeholder="15"></div>
      <div class="fi"><label>ì‚¬ìš©ì¼ ì¶”ê°€</label><input type="number" id="lvUsed" placeholder="0" min="0"></div>
      <div class="fi"><label>ì‚¬ìœ </label><input id="lvReason" placeholder="ì‚¬ìœ "></div>
      <div class="fi"><label>ë‚ ì§œ</label><input type="date" id="lvDate"></div>
    </div></div>
    <div class="mf"><button class="btn bo" onclick="closeMo('moLeave')">ì·¨ì†Œ</button><button class="btn bp" onclick="saveLeave()">ì €ì¥</button></div>
  </div>
</div>

<!-- ì¼ê´„ ì—°ì°¨ ëª¨ë‹¬ -->
<div id="moBulk" class="mo">
  <div class="mb">
    <div class="mh"><h3>ì¼ê´„ ì—°ì°¨ ì§€ê¸‰</h3><button class="mx" onclick="closeMo('moBulk')">Ã—</button></div>
    <div class="mc"><div class="fg">
      <div class="fi"><label>íšŒê³„ì—°ë„ *</label><input type="number" id="blYr"></div>
      <div class="fi"><label>ì§€ê¸‰ ì—°ì°¨ì¼ìˆ˜ *</label><input type="number" id="blDays" placeholder="15"></div>
    </div>
    <p style="font-size:13px;color:var(--g500);margin-top:12px">â€» ì¬ì§ ì¤‘ì¸ ëª¨ë“  ì§ì›ì—ê²Œ ì¼ê´„ ì§€ê¸‰ë©ë‹ˆë‹¤.</p>
    </div>
    <div class="mf"><button class="btn bo" onclick="closeMo('moBulk')">ì·¨ì†Œ</button><button class="btn bp" onclick="saveBulk()">ì§€ê¸‰</button></div>
  </div>
</div>

<!-- êµìœ¡ ëª¨ë‹¬ -->
<div id="moEdu" class="mo">
  <div class="mb">
    <div class="mh"><h3 id="moEduT">êµìœ¡ ì¶”ê°€</h3><button class="mx" onclick="closeMo('moEdu')">Ã—</button></div>
    <div class="mc"><div class="fg">
      <div class="fi"><label>ì§ì› *</label><select id="edEmp"><option value="">ì§ì› ì„ íƒ</option></select></div>
      <div class="fi"><label>êµìœ¡ëª… *</label><input id="edName" placeholder="ì•ˆì „êµìœ¡"></div>
      <div class="fi"><label>êµìœ¡ì¼ *</label><input type="date" id="edDate"></div>
      <div class="fi"><label>êµìœ¡ ìœ í˜•</label><select id="edType"><option>í•„ìˆ˜êµìœ¡</option><option>ì§ë¬´êµìœ¡</option><option>ì•ˆì „êµìœ¡</option><option>ê¸°íƒ€</option></select></div>
      <div class="fi"><label>ìˆ˜ë£Œì¦</label><input id="edCert" placeholder="ìˆ˜ë£Œì¦ ë²ˆí˜¸"></div>
      <div class="fi"><label>ìˆ˜ë£Œì¼</label><input type="date" id="edCertDate"></div>
      <div class="fi"><label>ë‹¤ìŒ êµìœ¡ì¼</label><input type="date" id="edNext"></div>
      <div class="fi"><label>ë©”ëª¨</label><input id="edMemo" placeholder="ë¹„ê³ "></div>
    </div></div>
    <div class="mf"><button class="btn bo" onclick="closeMo('moEdu')">ì·¨ì†Œ</button><button class="btn bp" onclick="saveEdu()">ì €ì¥</button></div>
  </div>
</div>

<script>
'use strict';
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Firebase REST API ì„¤ì •
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const FB_PROJ = 'sangwon-hrm';
const FB_KEY  = 'AIzaSyBebDpB0eFP2yDZ4NK6K8IoWS8aTseHkzc';
const FB_BASE = `https://firestore.googleapis.com/v1/projects/${FB_PROJ}/databases/(default)/documents`;

// â”€â”€ Firestore íƒ€ì… ë³€í™˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toFV(v) {
  if (v === null || v === undefined) return { nullValue: null };
  if (typeof v === 'boolean')  return { booleanValue: v };
  if (typeof v === 'number')   return Number.isInteger(v) ? { integerValue: String(v) } : { doubleValue: v };
  if (typeof v === 'string')   return { stringValue: v };
  if (Array.isArray(v))        return { arrayValue: { values: v.map(toFV) } };
  if (typeof v === 'object')   return { mapValue: { fields: toFs(v) } };
  return { stringValue: String(v) };
}
function toFs(obj) {
  const f = {};
  for (const [k, v] of Object.entries(obj)) f[k] = toFV(v);
  return f;
}
function fromFV(fv) {
  if (!fv) return null;
  if ('nullValue'    in fv) return null;
  if ('booleanValue' in fv) return fv.booleanValue;
  if ('integerValue' in fv) return Number(fv.integerValue);
  if ('doubleValue'  in fv) return fv.doubleValue;
  if ('stringValue'  in fv) return fv.stringValue;
  if ('arrayValue'   in fv) return (fv.arrayValue.values || []).map(fromFV);
  if ('mapValue'     in fv) return fromFs(fv.mapValue.fields || {});
  return null;
}
function fromFs(fields) {
  const o = {};
  for (const [k, v] of Object.entries(fields)) o[k] = fromFV(v);
  return o;
}

// â”€â”€ CRUD í•¨ìˆ˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fbGetAll(col) {
  const r = await fetch(`${FB_BASE}/${col}?key=${FB_KEY}&pageSize=500`);
  if (!r.ok) throw new Error(`HTTP ${r.status}`);
  const j = await r.json();
  if (!j.documents) return [];
  return j.documents.map(d => fromFs(d.fields || {}));
}

async function fbSet(col, id, data) {
  const eid = encodeURIComponent(String(id));
  const r = await fetch(`${FB_BASE}/${col}/${eid}?key=${FB_KEY}`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ fields: toFs(JSON.parse(JSON.stringify(data))) })
  });
  if (!r.ok) throw new Error(`HTTP ${r.status}`);
}

async function fbDel(col, id) {
  const eid = encodeURIComponent(String(id));
  const r = await fetch(`${FB_BASE}/${col}/${eid}?key=${FB_KEY}`, { method: 'DELETE' });
  if (!r.ok) throw new Error(`HTTP ${r.status}`);
}

async function fbReplaceAll(col, arr) {
  const old = await fbGetAll(col);
  for (const d of old) await fbDel(col, d.id || d.employeeId || '');
  for (const item of arr) {
    const id = String(item.id || item.employeeId || Date.now());
    await fbSet(col, id, item);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì•± ìƒíƒœ (ë©”ëª¨ë¦¬ ìºì‹œ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let DB = { emp: [], leave: [], edu: [], users: [] };
let CU = null;       // í˜„ì¬ ë¡œê·¸ì¸ ìœ ì €
let editEmp = null;  // ìˆ˜ì • ì¤‘ì¸ ì§ì›
let editEdu = null;  // ìˆ˜ì • ì¤‘ì¸ êµìœ¡

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì´ˆê¸°í™” â€” ì•± ì‹œì‘ì 
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function init() {
  // 1) ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ í™•ì¸
  const saved = sessionStorage.getItem('cu');
  if (saved) { try { CU = JSON.parse(saved); } catch(e) {} }

  // 2) Firebaseì—ì„œ ì „ì²´ ë°ì´í„° 1íšŒ ë¡œë“œ
  try {
    await loadAll();
  } catch(e) {
    showErr('Firebase ì—°ê²° ì‹¤íŒ¨: ' + e.message);
    return;
  }

  // 3) ê´€ë¦¬ì ê³„ì • ì—†ìœ¼ë©´ ìë™ ìƒì„±
  if (!DB.users.find(u => u.role === 'admin')) {
    const adm = { id:'admin', pw:'admin1234', name:'ê´€ë¦¬ì', role:'admin', status:'approved', createdAt: new Date().toISOString() };
    await fbSet('sysUsers', 'admin', adm);
    DB.users.push(adm);
  }

  // 4) ë¡œê·¸ì¸ ìƒíƒœ ë³µì› ë˜ëŠ” ì¸ì¦ í™”ë©´ í‘œì‹œ
  if (CU) {
    const fresh = DB.users.find(u => u.id === CU.id);
    if (fresh && fresh.status === 'approved') {
      CU = fresh;
      sessionStorage.setItem('cu', JSON.stringify(CU));
      showApp();
    } else {
      sessionStorage.removeItem('cu');
      CU = null;
      showAuth();
    }
  } else {
    showAuth();
  }
}

// ì „ì²´ ë°ì´í„° ë¡œë“œ (ë¡œê·¸ì¸ ì‹œ + ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ì‹œë§Œ í˜¸ì¶œ)
async function loadAll() {
  const [e, l, ed, u] = await Promise.all([
    fbGetAll('employees'),
    fbGetAll('annualLeaves'),
    fbGetAll('educations'),
    fbGetAll('sysUsers'),
  ]);
  DB.emp   = e;
  DB.leave = l;
  DB.edu   = ed;
  DB.users = u;
}

// ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼
async function reloadData() {
  const btn = document.querySelector('.rbtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span>ë¡œë”© ì¤‘...';
  try {
    await loadAll();
    refreshUI();
    btn.innerHTML = 'âœ… ì™„ë£Œ!';
    setTimeout(() => { btn.disabled = false; btn.innerHTML = 'ğŸ”„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨'; }, 2000);
  } catch(e) {
    btn.innerHTML = 'âŒ ì‹¤íŒ¨ - ë‹¤ì‹œ ì‹œë„';
    btn.disabled = false;
  }
}

function showErr(msg) {
  document.getElementById('auth').classList.remove('on');
  document.body.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:100vh;flex-direction:column;gap:16px;font-family:sans-serif">
    <div style="font-size:48px">âŒ</div>
    <h2 style="color:#dc2626">ì—°ê²° ì˜¤ë¥˜</h2>
    <p style="color:#6b7280">${msg}</p>
    <button onclick="location.reload()" style="padding:10px 24px;background:#2563eb;color:white;border:none;border-radius:8px;cursor:pointer;font-size:14px">ë‹¤ì‹œ ì‹œë„</button>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì¸ì¦
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(t) {
  document.querySelectorAll('.atab').forEach((b, i) =>
    b.classList.toggle('on', (i===0&&t==='login')||(i===1&&t==='reg')));
  document.getElementById('fLogin').classList.toggle('on', t === 'login');
  document.getElementById('fReg').classList.toggle('on', t === 'reg');
}

async function doLogin() {
  const id  = document.getElementById('lId').value.trim();
  const pw  = document.getElementById('lPw').value;
  const msg = document.getElementById('lMsg');
  const btn = document.getElementById('lBtn');
  msg.className = 'msg';

  if (!id || !pw) { setMsg(msg, 'err', 'ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }

  // ë¡œê·¸ì¸ ì‹œ ìµœì‹  ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ (ì‚¬ìš©ì ì»¬ë ‰ì…˜ë§Œ)
  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span>í™•ì¸ ì¤‘...';
  try {
    DB.users = await fbGetAll('sysUsers');
  } catch(e) {
    setMsg(msg, 'err', 'ì„œë²„ ì—°ê²° ì‹¤íŒ¨. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
    btn.disabled = false; btn.innerHTML = 'ë¡œê·¸ì¸';
    return;
  }

  const u = DB.users.find(u => u.id === id && u.pw === pw);
  btn.disabled = false; btn.innerHTML = 'ë¡œê·¸ì¸';

  if (!u)                    { setMsg(msg, 'err', 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
  if (u.status === 'pending') { setMsg(msg, 'err', 'ê´€ë¦¬ì ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.'); return; }
  if (u.status === 'rejected'){ setMsg(msg, 'err', 'ê°€ì…ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.'); return; }

  CU = u;
  sessionStorage.setItem('cu', JSON.stringify(CU));

  // ë‚˜ë¨¸ì§€ ë°ì´í„° ë¡œë“œ í›„ ì•± í‘œì‹œ
  btn.disabled = true; btn.innerHTML = '<span class="spin"></span>ë°ì´í„° ë¡œë”© ì¤‘...';
  try {
    const [e, l, ed] = await Promise.all([
      fbGetAll('employees'),
      fbGetAll('annualLeaves'),
      fbGetAll('educations'),
    ]);
    DB.emp = e; DB.leave = l; DB.edu = ed;
  } catch(e) {
    console.warn('ë°ì´í„° ë¡œë“œ ì¼ë¶€ ì‹¤íŒ¨', e);
  }
  btn.disabled = false; btn.innerHTML = 'ë¡œê·¸ì¸';
  showApp();
}

async function doRegister() {
  const name = document.getElementById('rName').value.trim();
  const id   = document.getElementById('rId').value.trim();
  const pw   = document.getElementById('rPw').value;
  const pw2  = document.getElementById('rPw2').value;
  const msg  = document.getElementById('rMsg');
  const btn  = document.getElementById('rBtn');
  msg.className = 'msg';

  if (!name||!id||!pw||!pw2) { setMsg(msg,'err','ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  if (id.length < 4)          { setMsg(msg,'err','ì•„ì´ë””ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'); return; }
  if (pw.length < 6)          { setMsg(msg,'err','ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'); return; }
  if (pw !== pw2)             { setMsg(msg,'err','ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }

  btn.disabled = true; btn.innerHTML = '<span class="spin"></span>ì²˜ë¦¬ ì¤‘...';
  try {
    DB.users = await fbGetAll('sysUsers');
    if (DB.users.find(u => u.id === id)) {
      setMsg(msg, 'err', 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.');
      btn.disabled = false; btn.innerHTML = 'íšŒì›ê°€ì… ì‹ ì²­';
      return;
    }
    const nu = { id, pw, name, role:'user', status:'pending', createdAt: new Date().toISOString() };
    await fbSet('sysUsers', id, nu);
    DB.users.push(nu);
    setMsg(msg, 'ok', 'âœ… íšŒì›ê°€ì… ì‹ ì²­ ì™„ë£Œ! ê´€ë¦¬ì ìŠ¹ì¸ í›„ ë¡œê·¸ì¸í•˜ì„¸ìš”.');
    ['rName','rId','rPw','rPw2'].forEach(x => document.getElementById(x).value = '');
  } catch(e) {
    setMsg(msg, 'err', 'ì„œë²„ ì˜¤ë¥˜. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
  }
  btn.disabled = false; btn.innerHTML = 'íšŒì›ê°€ì… ì‹ ì²­';
}

function doLogout() {
  if (!confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  sessionStorage.removeItem('cu');
  CU = null;
  location.reload();
}

function setMsg(el, type, text) { el.className = 'msg ' + type; el.textContent = text; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// í™”ë©´ ì „í™˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showAuth() {
  document.getElementById('auth').classList.add('on');
  document.getElementById('hdr').style.display = 'none';
  document.getElementById('refreshBar').style.display = 'none';
  document.getElementById('nav').style.display = 'none';
  document.getElementById('main').style.display = 'none';
}

function showApp() {
  document.getElementById('auth').classList.remove('on');
  document.getElementById('hdr').style.display = '';
  document.getElementById('refreshBar').style.display = '';
  document.getElementById('nav').style.display = '';
  document.getElementById('main').style.display = '';

  // í—¤ë” ì •ë³´
  document.getElementById('hName').textContent = CU.name;
  const b = document.getElementById('hBadge');
  b.textContent = CU.role === 'admin' ? 'ê´€ë¦¬ì' : 'ì¼ë°˜';
  b.className   = 'ub ' + CU.role;

  // ê´€ë¦¬ì ì „ìš© íƒ­
  document.getElementById('nAdmin').style.display = CU.role === 'admin' ? '' : 'none';
  document.getElementById('nLeave').style.display = CU.role === 'admin' ? '' : 'none';

  // ì—°ë„ ì…€ë ‰íŠ¸ ì´ˆê¸°í™”
  const ly  = document.getElementById('leaveYr');
  const yr  = new Date().getFullYear();
  ly.innerHTML = '';
  for (let y = yr+1; y >= yr-3; y--) ly.innerHTML += `<option value="${y}">${y}ë…„</option>`;
  ly.value = yr;

  refreshUI();
  go('dash');
}

function refreshUI() {
  renderDash();
  renderEmp();
  renderLeave();
  renderEdu();
  document.getElementById('bkE').textContent  = DB.emp.length   + 'ëª…';
  document.getElementById('bkL').textContent  = DB.leave.length + 'ê±´';
  document.getElementById('bkEd').textContent = DB.edu.length   + 'ê±´';
  if (CU && CU.role === 'admin') renderAdmin();
}

function go(name, btn) {
  document.querySelectorAll('.pg').forEach(p => p.classList.remove('on'));
  document.querySelectorAll('.nb').forEach(b => b.classList.remove('on'));
  document.getElementById('p-' + name).classList.add('on');
  if (btn) btn.classList.add('on');
  else document.querySelectorAll('.nb').forEach(b => {
    if (b.getAttribute('onclick') && b.getAttribute('onclick').includes(`'${name}'`)) b.classList.add('on');
  });
}

function closeMo(id) { document.getElementById(id).classList.remove('on'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ëŒ€ì‹œë³´ë“œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDash() {
  const now    = new Date();
  const total  = DB.emp.length;
  const active = DB.emp.filter(e => !e.resignDate || new Date(e.resignDate) > now).length;
  const mon    = now.getMonth() + 1;
  const bday   = DB.emp.filter(e => e.birthDate && new Date(e.birthDate).getMonth()+1 === mon).length;

  document.getElementById('dTotal').textContent    = total;
  document.getElementById('dActive').textContent   = active;
  document.getElementById('dInactive').textContent = total - active;
  document.getElementById('dBday').textContent     = bday;

  const recent = [...DB.emp].sort((a,b) => new Date(b.joinDate||0) - new Date(a.joinDate||0)).slice(0, 5);
  const el     = document.getElementById('dRecent');
  if (!recent.length) {
    el.innerHTML = '<div class="empty"><div class="ico">ğŸ‘¥</div><p>ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
    return;
  }
  el.innerHTML = `<div class="tw"><table>
    <thead><tr><th>ì´ë¦„</th><th>ë¶€ì„œ</th><th>ì§ì±…</th><th>ì…ì‚¬ì¼</th><th>ìƒíƒœ</th></tr></thead>
    <tbody>${recent.map(e => `<tr>
      <td><strong>${e.name}</strong></td>
      <td>${e.department||'-'}</td>
      <td>${e.position||'-'}</td>
      <td>${e.joinDate ? new Date(e.joinDate).toLocaleDateString('ko-KR') : '-'}</td>
      <td>${!e.resignDate||new Date(e.resignDate)>now ? '<span class="badge bgr">ì¬ì§</span>' : '<span class="badge bgy">í‡´ì‚¬</span>'}</td>
    </tr>`).join('')}</tbody>
  </table></div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì§ì›ê´€ë¦¬
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderEmp() {
  const q   = (document.getElementById('empQ')||{}).value || '';
  const now = new Date();
  const list = DB.emp
    .filter(e => !q || (e.name||'').includes(q) || (e.department||'').includes(q) || (e.position||'').includes(q))
    .sort((a,b) => (a.name||'').localeCompare(b.name||''));

  const tb = document.getElementById('empTb');
  if (!list.length) {
    tb.innerHTML = '<tr><td colspan="7"><div class="empty"><div class="ico">ğŸ‘¥</div><p>ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>';
    return;
  }
  tb.innerHTML = list.map(e => {
    const on = !e.resignDate || new Date(e.resignDate) > now;
    return `<tr>
      <td><strong>${e.name}</strong></td>
      <td>${e.department||'-'}</td>
      <td>${e.position||'-'}</td>
      <td>${e.joinDate ? new Date(e.joinDate).toLocaleDateString('ko-KR') : '-'}</td>
      <td>${e.phone||'-'}</td>
      <td>${on ? '<span class="badge bgr">ì¬ì§</span>' : '<span class="badge bgy">í‡´ì‚¬</span>'}</td>
      <td>
        <button class="btn bo bsm" onclick="openEmpMo('${e.id}')">ìˆ˜ì •</button>
        <button class="btn bd bsm" style="margin-left:4px" onclick="delEmp('${e.id}')">ì‚­ì œ</button>
      </td>
    </tr>`;
  }).join('');
}

function openEmpMo(id) {
  editEmp = id ? DB.emp.find(e => e.id === id) : null;
  document.getElementById('moEmpT').textContent = editEmp ? 'ì§ì› ìˆ˜ì •' : 'ì§ì› ë“±ë¡';
  const f = editEmp || {};
  ['eName','eDept','ePos','eJoin','ePhone','eBirth','eEmail','eResign','eMemo'].forEach(x => {
    const el = document.getElementById(x);
    el.value = '';
  });
  if (f.name)       document.getElementById('eName').value   = f.name;
  if (f.department) document.getElementById('eDept').value   = f.department;
  if (f.position)   document.getElementById('ePos').value    = f.position;
  if (f.joinDate)   document.getElementById('eJoin').value   = f.joinDate;
  if (f.phone)      document.getElementById('ePhone').value  = f.phone;
  if (f.birthDate)  document.getElementById('eBirth').value  = f.birthDate;
  if (f.email)      document.getElementById('eEmail').value  = f.email;
  if (f.resignDate) document.getElementById('eResign').value = f.resignDate;
  if (f.memo)       document.getElementById('eMemo').value   = f.memo;
  document.getElementById('moEmp').classList.add('on');
}

async function saveEmp() {
  const name = document.getElementById('eName').value.trim();
  const dept = document.getElementById('eDept').value.trim();
  const pos  = document.getElementById('ePos').value.trim();
  const join = document.getElementById('eJoin').value;
  if (!name||!dept||!pos||!join) { alert('ì´ë¦„, ë¶€ì„œ, ì§ì±…, ì…ì‚¬ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.'); return; }

  const btn = document.getElementById('empSaveBtn');
  btn.disabled = true; btn.innerHTML = '<span class="spin"></span>ì €ì¥ ì¤‘...';

  const id  = editEmp ? editEmp.id : 'emp_' + Date.now();
  const emp = {
    id, name, department: dept, position: pos, joinDate: join,
    phone:      document.getElementById('ePhone').value.trim(),
    birthDate:  document.getElementById('eBirth').value,
    email:      document.getElementById('eEmail').value.trim(),
    resignDate: document.getElementById('eResign').value,
    memo:       document.getElementById('eMemo').value.trim(),
    updatedAt:  new Date().toISOString()
  };

  try {
    await fbSet('employees', id, emp);
    const idx = DB.emp.findIndex(e => e.id === id);
    if (idx >= 0) DB.emp[idx] = emp; else DB.emp.push(emp);
    closeMo('moEmp');
    renderDash(); renderEmp();
  } catch(e) {
    alert('ì €ì¥ ì‹¤íŒ¨: ' + e.message);
  }
  btn.disabled = false; btn.innerHTML = 'ì €ì¥';
}

async function delEmp(id) {
  if (!confirm('ì´ ì§ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  try {
    await fbDel('employees', id);
    DB.emp = DB.emp.filter(e => e.id !== id);
    renderDash(); renderEmp();
  } catch(e) { alert('ì‚­ì œ ì‹¤íŒ¨: ' + e.message); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì—°ì°¨ê´€ë¦¬
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLeave() {
  if (!CU || CU.role !== 'admin') return;
  const yr  = parseInt((document.getElementById('leaveYr')||{}).value || new Date().getFullYear());
  const now = new Date();
  const active = DB.emp.filter(e => !e.resignDate || new Date(e.resignDate) > now);
  const tb = document.getElementById('leaveTb');

  if (!active.length) {
    tb.innerHTML = '<tr><td colspan="7"><div class="empty"><div class="ico">ğŸ“…</div><p>ì¬ì§ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>';
    return;
  }
  tb.innerHTML = active.map(emp => {
    const lv     = DB.leave.find(l => l.employeeId === emp.id && Number(l.year) === yr);
    const total  = lv ? Number(lv.totalDays)||0 : 0;
    const used   = lv ? (lv.usageHistory||[]).reduce((s,h) => s+Number(h.days||0), 0) : 0;
    const remain = total - used;
    const pct    = total > 0 ? Math.min(100, Math.round(used/total*100)) : 0;
    const barClr = pct > 80 ? 'var(--d)' : 'var(--p)';

    return `<tr>
      <td><strong>${emp.name}</strong></td>
      <td>${emp.department||'-'}</td>
      <td>${total}ì¼</td>
      <td>${used}ì¼</td>
      <td>${remain}ì¼</td>
      <td>
        <div style="display:flex;align-items:center;gap:8px">
          <div class="lbw"><div class="lbb" style="width:${pct}%;background:${barClr}"></div></div>
          <span style="font-size:12px;color:var(--g500)">${pct}%</span>
        </div>
      </td>
      <td>
        <button class="btn bo bsm" onclick="openLeaveMo('${emp.id}')">ì¶”ê°€</button>
        ${lv ? `<button class="btn bd bsm" style="margin-left:4px" onclick="delLeave('${emp.id}',${yr})">ì‚­ì œ</button>` : ''}
      </td>
    </tr>`;
  }).join('');
}

function openLeaveMo(empId) {
  const sel = document.getElementById('lvEmp');
  sel.innerHTML = '<option value="">ì§ì› ì„ íƒ</option>';
  DB.emp.filter(e => !e.resignDate || new Date(e.resignDate) > new Date()).forEach(e =>
    sel.innerHTML += `<option value="${e.id}" ${e.id===empId?'selected':''}>${e.name} (${e.department||'-'})</option>`
  );
  document.getElementById('lvYr').value     = (document.getElementById('leaveYr')||{}).value || new Date().getFullYear();
  document.getElementById('lvTotal').value  = '';
  document.getElementById('lvUsed').value   = '';
  document.getElementById('lvReason').value = '';
  document.getElementById('lvDate').value   = new Date().toISOString().slice(0,10);
  document.getElementById('moLeave').classList.add('on');
}

async function saveLeave() {
  const empId  = document.getElementById('lvEmp').value;
  const yr     = parseInt(document.getElementById('lvYr').value);
  const total  = parseInt(document.getElementById('lvTotal').value);
  const used   = parseInt(document.getElementById('lvUsed').value) || 0;
  const reason = document.getElementById('lvReason').value.trim();
  const date   = document.getElementById('lvDate').value;
  if (!empId||!yr||isNaN(total)) { alert('ì§ì›, ì—°ë„, ì´ ì—°ì°¨ì¼ìˆ˜ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.'); return; }

  const emp = DB.emp.find(e => e.id === empId);
  const lid = `lv_${empId}_${yr}`;
  let lv    = DB.leave.find(l => l.id === lid);

  if (lv) {
    lv.totalDays = total;
    if (used > 0) lv.usageHistory = [...(lv.usageHistory||[]), { days:used, reason, date, recordDate:new Date().toISOString() }];
  } else {
    lv = { id:lid, employeeId:empId, employeeName:emp.name, year:yr, totalDays:total,
           usageHistory: used>0 ? [{ days:used, reason, date, recordDate:new Date().toISOString() }] : [] };
    DB.leave.push(lv);
  }

  try {
    await fbSet('annualLeaves', lid, lv);
    const idx = DB.leave.findIndex(l => l.id === lid);
    if (idx >= 0) DB.leave[idx] = lv;
    closeMo('moLeave'); renderLeave();
  } catch(e) { alert('ì €ì¥ ì‹¤íŒ¨: ' + e.message); }
}

async function delLeave(empId, yr) {
  if (!confirm('ì´ ì—°ì°¨ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  const lid = `lv_${empId}_${yr}`;
  try {
    await fbDel('annualLeaves', lid);
    DB.leave = DB.leave.filter(l => l.id !== lid);
    renderLeave();
  } catch(e) { alert('ì‚­ì œ ì‹¤íŒ¨: ' + e.message); }
}

function openBulkMo() {
  document.getElementById('blYr').value  = new Date().getFullYear();
  document.getElementById('blDays').value = '';
  document.getElementById('moBulk').classList.add('on');
}

async function saveBulk() {
  const yr   = parseInt(document.getElementById('blYr').value);
  const days = parseInt(document.getElementById('blDays').value);
  if (!yr||isNaN(days)||days<=0) { alert('ì—°ë„ì™€ ì§€ê¸‰ì¼ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }

  const active = DB.emp.filter(e => !e.resignDate || new Date(e.resignDate) > new Date());
  try {
    for (const emp of active) {
      const lid = `lv_${emp.id}_${yr}`;
      let lv = DB.leave.find(l => l.id === lid);
      if (!lv) {
        lv = { id:lid, employeeId:emp.id, employeeName:emp.name, year:yr, totalDays:days, usageHistory:[] };
        DB.leave.push(lv);
      } else { lv.totalDays = days; }
      await fbSet('annualLeaves', lid, lv);
      const idx = DB.leave.findIndex(l => l.id === lid);
      if (idx >= 0) DB.leave[idx] = lv;
    }
    closeMo('moBulk'); renderLeave();
    alert(`âœ… ${active.length}ëª…ì—ê²Œ ${days}ì¼ ì—°ì°¨ë¥¼ ì§€ê¸‰í–ˆìŠµë‹ˆë‹¤.`);
  } catch(e) { alert('ì €ì¥ ì‹¤íŒ¨: ' + e.message); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì§ë¬´êµìœ¡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderEdu() {
  const q   = (document.getElementById('eduQ')||{}).value || '';
  const now = new Date();
  const list = DB.edu
    .filter(e => !q || (e.employeeName||'').includes(q) || (e.name||'').includes(q))
    .sort((a,b) => new Date(b.educationDate||0) - new Date(a.educationDate||0));

  const tb = document.getElementById('eduTb');
  if (!list.length) {
    tb.innerHTML = '<tr><td colspan="7"><div class="empty"><div class="ico">ğŸ“š</div><p>êµìœ¡ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>';
    return;
  }
  tb.innerHTML = list.map(e => {
    let badge = '<span class="badge bgy">-</span>';
    if (e.nextDate) {
      const diff = Math.ceil((new Date(e.nextDate) - now) / 86400000);
      if      (diff < 0)  badge = '<span class="badge brd">ë§Œë£Œ</span>';
      else if (diff < 30) badge = `<span class="badge byw">D-${diff}</span>`;
      else                badge = `<span class="badge bgr">D-${diff}</span>`;
    }
    return `<tr>
      <td><strong>${e.employeeName||'-'}</strong></td>
      <td>${e.name||'-'}</td>
      <td>${e.educationDate ? new Date(e.educationDate).toLocaleDateString('ko-KR') : '-'}</td>
      <td>${e.certificate||'-'}</td>
      <td>${e.nextDate ? new Date(e.nextDate).toLocaleDateString('ko-KR') : '-'}</td>
      <td>${badge}</td>
      <td>
        <button class="btn bo bsm" onclick="openEduMo('${e.id}')">ìˆ˜ì •</button>
        <button class="btn bd bsm" style="margin-left:4px" onclick="delEdu('${e.id}')">ì‚­ì œ</button>
      </td>
    </tr>`;
  }).join('');
}

function openEduMo(id) {
  editEdu = id ? DB.edu.find(e => e.id === id) : null;
  document.getElementById('moEduT').textContent = editEdu ? 'êµìœ¡ ìˆ˜ì •' : 'êµìœ¡ ì¶”ê°€';
  const sel = document.getElementById('edEmp');
  sel.innerHTML = '<option value="">ì§ì› ì„ íƒ</option>';
  DB.emp.forEach(e =>
    sel.innerHTML += `<option value="${e.id}|${e.name}" ${editEdu&&editEdu.employeeId===e.id?'selected':''}>${e.name} (${e.department||'-'})</option>`
  );
  const f = editEdu || {};
  document.getElementById('edName').value     = f.name||'';
  document.getElementById('edDate').value     = f.educationDate||'';
  document.getElementById('edType').value     = f.type||'í•„ìˆ˜êµìœ¡';
  document.getElementById('edCert').value     = f.certificate||'';
  document.getElementById('edCertDate').value = f.certificateDate||'';
  document.getElementById('edNext').value     = f.nextDate||'';
  document.getElementById('edMemo').value     = f.memo||'';
  document.getElementById('moEdu').classList.add('on');
}

async function saveEdu() {
  const ev   = document.getElementById('edEmp').value;
  const name = document.getElementById('edName').value.trim();
  const date = document.getElementById('edDate').value;
  if (!ev||!name||!date) { alert('ì§ì›, êµìœ¡ëª…, êµìœ¡ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.'); return; }

  const [empId, empName] = ev.split('|');
  const id  = editEdu ? editEdu.id : 'edu_' + Date.now();
  const edu = {
    id, employeeId: empId, employeeName: empName, name, educationDate: date,
    type:            document.getElementById('edType').value,
    certificate:     document.getElementById('edCert').value.trim(),
    certificateDate: document.getElementById('edCertDate').value,
    nextDate:        document.getElementById('edNext').value,
    memo:            document.getElementById('edMemo').value.trim(),
  };

  try {
    await fbSet('educations', id, edu);
    const idx = DB.edu.findIndex(e => e.id === id);
    if (idx >= 0) DB.edu[idx] = edu; else DB.edu.push(edu);
    closeMo('moEdu'); renderEdu();
  } catch(e) { alert('ì €ì¥ ì‹¤íŒ¨: ' + e.message); }
}

async function delEdu(id) {
  if (!confirm('ì´ êµìœ¡ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  try {
    await fbDel('educations', id);
    DB.edu = DB.edu.filter(e => e.id !== id);
    renderEdu();
  } catch(e) { alert('ì‚­ì œ ì‹¤íŒ¨: ' + e.message); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë°±ì—…
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function dlBackup() {
  const data = { employees: DB.emp, annualLeaves: DB.leave, educations: DB.edu, exportedAt: new Date().toISOString() };
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([JSON.stringify(data, null, 2)], { type:'application/json' }));
  a.download = `backup_${new Date().toISOString().slice(0,10)}.json`;
  a.click();
}

async function restoreBackup(event) {
  const file = event.target.files[0];
  if (!file) return;
  if (!confirm('í˜„ì¬ ë°ì´í„°ê°€ ëª¨ë‘ êµì²´ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  try {
    const bd = JSON.parse(await file.text());
    if (bd.employees)    { await fbReplaceAll('employees',   bd.employees);    DB.emp   = bd.employees; }
    if (bd.annualLeaves) { await fbReplaceAll('annualLeaves',bd.annualLeaves); DB.leave = bd.annualLeaves; }
    if (bd.educations)   { await fbReplaceAll('educations',  bd.educations);   DB.edu   = bd.educations; }
    refreshUI();
    alert('âœ… ë°±ì—… ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
  } catch(e) { alert('ë°±ì—… íŒŒì¼ ì˜¤ë¥˜: ' + e.message); }
  event.target.value = '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ê´€ë¦¬ì íŒ¨ë„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderAdmin() {
  // ê´€ë¦¬ì íƒ­ì—ì„œë§Œ ìµœì‹  ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
  try {
    DB.users = await fbGetAll('sysUsers');
  } catch(e) {
    console.warn('sysUsers ë¡œë“œ ì‹¤íŒ¨', e);
  }

  const pending = DB.users.filter(u => u.status === 'pending');

  // ë„¤ë¹„ ë±ƒì§€
  const pb = document.getElementById('pbadge');
  if (pending.length) { pb.textContent = pending.length; pb.style.display = ''; }
  else pb.style.display = 'none';

  // ìŠ¹ì¸ ëŒ€ê¸°
  const pl = document.getElementById('pList');
  pl.innerHTML = !pending.length
    ? '<div class="empty"><div class="ico">âœ…</div><p>ëŒ€ê¸° ì¤‘ì¸ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤</p></div>'
    : pending.map(u => `
      <div class="pi">
        <div>
          <strong>${u.name}</strong>
          <span style="color:var(--g500);margin-left:8px">(${u.id})</span>
          <span style="font-size:12px;color:var(--g400);margin-left:8px">${new Date(u.createdAt).toLocaleDateString('ko-KR')} ì‹ ì²­</span>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn bs bsm" onclick="approveUser('${u.id}')">âœ… ìŠ¹ì¸</button>
          <button class="btn bd bsm" onclick="rejectUser('${u.id}')">âŒ ê±°ì ˆ</button>
        </div>
      </div>`).join('');

  // ì „ì²´ íšŒì›
  const all = DB.users.filter(u => u.role !== 'admin');
  const ut  = document.getElementById('uTb');
  ut.innerHTML = !all.length
    ? '<tr><td colspan="5"><div class="empty"><div class="ico">ğŸ‘¥</div><p>ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>'
    : all.map(u => `<tr>
        <td><strong>${u.name}</strong></td>
        <td>${u.id}</td>
        <td>${u.status==='approved'?'<span class="badge bgr">ìŠ¹ì¸ë¨</span>':u.status==='pending'?'<span class="badge byw">ëŒ€ê¸°ì¤‘</span>':'<span class="badge brd">ê±°ì ˆë¨</span>'}</td>
        <td>${new Date(u.createdAt).toLocaleDateString('ko-KR')}</td>
        <td>
          ${u.status!=='approved'?`<button class="btn bs bsm" onclick="approveUser('${u.id}')">ìŠ¹ì¸</button>`:''}
          <button class="btn bd bsm" style="margin-left:4px" onclick="delUser('${u.id}')">ì‚­ì œ</button>
        </td>
      </tr>`).join('');
}

async function approveUser(id) {
  const u = DB.users.find(u => u.id === id);
  if (!u) return;
  u.status = 'approved';
  try {
    await fbSet('sysUsers', id, u);
    renderAdmin();
    alert(`âœ… ${u.name}(${u.id}) ìŠ¹ì¸ ì™„ë£Œ`);
  } catch(e) { alert('ì²˜ë¦¬ ì‹¤íŒ¨: ' + e.message); }
}

async function rejectUser(id) {
  const u = DB.users.find(u => u.id === id);
  if (!u || !confirm(`${u.name}(${u.id}) íšŒì› ê°€ì…ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
  u.status = 'rejected';
  try {
    await fbSet('sysUsers', id, u);
    renderAdmin();
  } catch(e) { alert('ì²˜ë¦¬ ì‹¤íŒ¨: ' + e.message); }
}

async function delUser(id) {
  if (!confirm('ì´ íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  try {
    await fbDel('sysUsers', id);
    DB.users = DB.users.filter(u => u.id !== id);
    renderAdmin();
  } catch(e) { alert('ì‚­ì œ ì‹¤íŒ¨: ' + e.message); }
}

async function updateAdmin() {
  const newId  = document.getElementById('aNewId').value.trim();
  const curPw  = document.getElementById('aCurPw').value;
  const newPw  = document.getElementById('aNewPw').value;
  const newPw2 = document.getElementById('aNewPw2').value;

  if (!curPw)                        { alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
  if (curPw !== CU.pw)               { alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
  if (newPw && newPw.length < 6)     { alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'); return; }
  if (newPw && newPw !== newPw2)     { alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }

  const updated = { ...CU, pw: newPw || CU.pw };
  if (newId) updated.id = newId;

  try {
    await fbSet('sysUsers', updated.id, updated);
    if (newId && newId !== CU.id) await fbDel('sysUsers', CU.id);
    CU = updated;
    sessionStorage.setItem('cu', JSON.stringify(CU));
    alert('âœ… ê³„ì •ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
  } catch(e) { alert('ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ' + e.message); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì•± ì‹œì‘
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
init();
</script>
</body>
</html>
