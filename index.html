<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§ì›ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 25px 30px;
            border-bottom: 3px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-left h1 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .header-left p {
            font-size: 0.95em;
            opacity: 0.9;
        }

        .header-right {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .header-btn {
            padding: 10px 20px;
            border: 2px solid white;
            background: transparent;
            color: white;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .header-btn:hover {
            background: white;
            color: #2c3e50;
        }

        .nav-tabs {
            display: flex;
            background: #ecf0f1;
            border-bottom: 2px solid #bdc3c7;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 0.95em;
            font-weight: 600;
            color: #2c3e50;
            transition: all 0.3s;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
        }

        .nav-tab:hover {
            background: #d5dbdb;
        }

        .nav-tab.active {
            color: #3498db;
            background: white;
            border-bottom-color: #3498db;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #ecf0f1;
            cursor: pointer;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: #3498db;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .card h3 {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .card .number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .card .icon {
            font-size: 2em;
            float: right;
            opacity: 0.3;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-info {
            background: #16a085;
            color: white;
        }

        .btn-info:hover {
            background: #138d75;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid #ecf0f1;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: #34495e;
            color: white;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.9em;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-secondary {
            background: #e2e3e5;
            color: #383d41;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px;
        }

        .modal-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .modal-header h2 {
            color: #2c3e50;
            font-size: 1.5em;
        }

        .close-modal {
            float: right;
            font-size: 1.5em;
            cursor: pointer;
            color: #7f8c8d;
            font-weight: normal;
        }

        .close-modal:hover {
            color: #2c3e50;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95em;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }

            .header-left h1 {
                font-size: 1.5em;
            }

            .header-right {
                width: 100%;
            }

            .header-btn {
                flex: 1;
                justify-content: center;
            }

            .nav-tab {
                padding: 12px 15px;
                font-size: 0.85em;
            }

            .tab-content {
                padding: 15px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .card .number {
                font-size: 2em;
            }
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .certificate-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 3px solid #3498db;
        }

        .certificate-item h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .certificate-item .education-dates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .certificate-item .education-dates label {
            font-size: 0.85em;
            color: #7f8c8d;
        }

        .certificate-item .education-dates input {
            margin-top: 5px;
        }

        .add-certificate-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
        }

        .add-certificate-btn:hover {
            background: #229954;
        }

        .remove-certificate-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
            float: right;
        }

        .detail-modal {
            max-width: 900px;
        }

        .info-section {
            margin-bottom: 25px;
        }

        .info-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .info-item label {
            font-size: 0.85em;
            color: #7f8c8d;
            display: block;
            margin-bottom: 5px;
        }

        .info-item .value {
            font-weight: 600;
            color: #2c3e50;
        }

        .annual-leave-history {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 3px solid #3498db;
        }

        .history-item .date {
            font-weight: 600;
            color: #2c3e50;
        }

        .history-item .days {
            color: #e74c3c;
            font-weight: 600;
        }

        .no-data {
            text-align: center;
            color: #7f8c8d;
            padding: 40px;
            font-style: italic;
        }

        .education-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }

        .education-date-item {
            background: white;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .education-date-item label {
            font-size: 0.85em;
            color: #7f8c8d;
            display: block;
            margin-bottom: 5px;
        }

        .education-date-item input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 0.9em;
        }

        .backup-info {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }

        .backup-info h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .backup-info p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #27ae60;
            color: white;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input-label:hover {
            background: #229954;
        }

        #fileInputName {
            margin-left: 15px;
            color: #7f8c8d;
            font-style: italic;
        }

        /* ===== ì¸ì¦ ì‹œìŠ¤í…œ ===== */
        .auth-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#2c3e50,#3498db);z-index:9999;justify-content:center;align-items:center;}
        .auth-overlay.active{display:flex;}
        .auth-box{background:white;border-radius:12px;padding:40px;width:90%;max-width:420px;box-shadow:0 20px 60px rgba(0,0,0,.3);}
        .auth-box h2{color:#2c3e50;text-align:center;margin-bottom:8px;font-size:1.6em;}
        .auth-subtitle{text-align:center;color:#7f8c8d;margin-bottom:30px;font-size:.9em;}
        .auth-tabs{display:flex;margin-bottom:25px;border:1px solid #ddd;border-radius:6px;overflow:hidden;}
        .auth-tab-btn{flex:1;padding:10px;border:none;background:#f8f9fa;cursor:pointer;font-weight:600;font-size:.9em;color:#7f8c8d;transition:all .2s;}
        .auth-tab-btn.active{background:#3498db;color:white;}
        .auth-form{display:none;} .auth-form.active{display:block;}
        .auth-submit{width:100%;padding:12px;background:#3498db;color:white;border:none;border-radius:6px;font-size:1em;font-weight:700;cursor:pointer;margin-top:8px;}
        .auth-submit:hover{background:#2980b9;}
        .auth-error{background:#f8d7da;color:#721c24;padding:10px 14px;border-radius:5px;font-size:.88em;margin-bottom:15px;display:none;}
        .auth-error.visible{display:block;}
        .auth-success{background:#d4edda;color:#155724;padding:10px 14px;border-radius:5px;font-size:.88em;margin-bottom:15px;display:none;}
        .auth-success.visible{display:block;}
        .user-info-bar{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,.1);padding:6px 14px;border-radius:20px;font-size:.88em;}
        .user-badge{background:#f39c12;color:white;padding:2px 8px;border-radius:10px;font-size:.8em;font-weight:700;}
        .user-badge.admin{background:#e74c3c;}
        .logout-btn{padding:5px 12px;border:1px solid rgba(255,255,255,.6);background:transparent;color:white;border-radius:4px;cursor:pointer;font-size:.85em;}
        .logout-btn:hover{background:rgba(255,255,255,.2);}
        .pending-users-section{background:#fff3cd;border:1px solid #ffc107;border-radius:8px;padding:20px;margin-bottom:25px;}
        .pending-users-section h3{color:#856404;margin-bottom:15px;}
        .pending-user-item{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:white;border-radius:6px;margin-bottom:8px;border:1px solid #f0e8c8;}
        .admin-settings-section{background:#f8f9fa;border:1px solid #dee2e6;border-radius:8px;padding:20px;margin-bottom:25px;}
        .firebase-warning{background:#fff3cd;border:2px solid #ffc107;border-radius:8px;padding:15px 20px;margin:15px;display:none;}
        .firebase-warning a{color:#0056b3;}
    </style>
</head>
<body>
    <!-- Firebase ë¯¸ì„¤ì • ê²½ê³  -->
    <div id="firebaseWarning" class="firebase-warning">
        âš ï¸ <strong>Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤!</strong>
        index.html ìƒë‹¨ì˜ <code>firebaseConfig</code> ê°’ì„ ë³¸ì¸ Firebase í”„ë¡œì íŠ¸ ê°’ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”.
        (<a href="https://console.firebase.google.com" target="_blank">Firebase ì½˜ì†”</a>)
    </div>

    <!-- ì¸ì¦ ì˜¤ë²„ë ˆì´ -->
    <div id="authOverlay" class="auth-overlay active">
        <div class="auth-box">
            <h2>ğŸ¢ ì§ì›ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
            <p class="auth-subtitle">Employee Management System</p>
            <div class="auth-tabs">
                <button class="auth-tab-btn active" onclick="switchAuthTab('login')">ë¡œê·¸ì¸</button>
                <button class="auth-tab-btn" onclick="switchAuthTab('register')">íšŒì›ê°€ì…</button>
            </div>
            <div id="loginForm" class="auth-form active">
                <div id="loginError" class="auth-error"></div>
                <div class="form-group"><label>ì•„ì´ë””</label><input type="text" id="loginId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></div>
                <div class="form-group"><label>ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeydown="if(event.key==='Enter') doLogin()"></div>
                <button class="auth-submit" onclick="doLogin()">ë¡œê·¸ì¸</button>
            </div>
            <div id="registerForm" class="auth-form">
                <div id="registerError" class="auth-error"></div>
                <div id="registerSuccess" class="auth-success"></div>
                <div class="form-group"><label>ì´ë¦„ *</label><input type="text" id="regName" placeholder="ì‹¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></div>
                <div class="form-group"><label>ì•„ì´ë”” *</label><input type="text" id="regId" placeholder="ì˜ë¬¸+ìˆ«ì, 4ì ì´ìƒ"></div>
                <div class="form-group"><label>ë¹„ë°€ë²ˆí˜¸ *</label><input type="password" id="regPw" placeholder="6ì ì´ìƒ"></div>
                <div class="form-group"><label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸ *</label><input type="password" id="regPw2" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥"></div>
                <button class="auth-submit" onclick="doRegister()">íšŒì›ê°€ì… ì‹ ì²­</button>
                <p style="text-align:center;color:#7f8c8d;font-size:.82em;margin-top:12px;">â€» ê´€ë¦¬ì ìŠ¹ì¸ í›„ ë¡œê·¸ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>ğŸ¢ ì§ì›ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <p>Employee Management System</p>
            </div>
            <div class="header-right">
                <div class="user-info-bar">
                    <span id="headerUserName">-</span>
                    <span id="headerUserBadge" class="user-badge">ì¼ë°˜</span>
                    <button class="logout-btn" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
                <button class="header-btn" onclick="downloadBackup()">
                    <span>ğŸ’¾</span>
                    <span>ë°±ì—… ë‹¤ìš´ë¡œë“œ</span>
                </button>
                <button class="header-btn" onclick="document.getElementById('restoreFileInput').click()">
                    <span>ğŸ“‚</span>
                    <span>ë°±ì—… ë¶ˆëŸ¬ì˜¤ê¸°</span>
                </button>
                <input type="file" id="restoreFileInput" accept=".json" style="display: none;" onchange="restoreBackup(event)">
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
            <button class="nav-tab" onclick="showTab('employees')">ğŸ‘¥ ì§ì›ê´€ë¦¬</button>
            <button class="nav-tab" id="annualLeaveTab" onclick="showAnnualLeaveTab()">ğŸ“… ì—°ì°¨ê´€ë¦¬ ğŸ”’</button>
            <button class="nav-tab" id="adminTab" onclick="showTab('admin')" style="display:none;">ğŸ›¡ï¸ ê´€ë¦¬ì</button>
            <button class="nav-tab" onclick="showTab('education')">ğŸ“š ì§ë¬´êµìœ¡</button>
            <button class="nav-tab" onclick="showTab('backup')">âš™ï¸ ë°±ì—…ê´€ë¦¬</button>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ -->
        <div id="dashboard" class="tab-content active">
            <h2 style="margin-bottom: 20px; color: #2c3e50;">ğŸ“Š ëŒ€ì‹œë³´ë“œ</h2>
            <div class="dashboard">
                <div class="card" onclick="showAllEmployees()">
                    <span class="icon">ğŸ‘¥</span>
                    <h3>ì „ì²´ ì§ì›</h3>
                    <div class="number" id="totalEmployees">0</div>
                </div>
                <div class="card" onclick="showActiveEmployees()">
                    <span class="icon">âœ…</span>
                    <h3>ì¬ì§ ì§ì›</h3>
                    <div class="number" id="activeEmployees">0</div>
                </div>
                <div class="card" onclick="showInactiveEmployees()">
                    <span class="icon">ğŸ“¤</span>
                    <h3>í‡´ì‚¬ ì§ì›</h3>
                    <div class="number" id="inactiveEmployees">0</div>
                </div>
                <div class="card" onclick="showUpcomingEducation()">
                    <span class="icon">ğŸ“š</span>
                    <h3>êµìœ¡ ì˜ˆì • (6ê°œì›”)</h3>
                    <div class="number" id="upcomingEducation">0</div>
                </div>
            </div>
        </div>

        <!-- ì§ì›ê´€ë¦¬ -->
        <div id="employees" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2c3e50;">ğŸ‘¥ ì§ì›ê´€ë¦¬</h2>
            <button class="btn btn-primary" onclick="openEmployeeModal()">+ ìƒˆ ì§ì› ë“±ë¡</button>
            
            <div class="search-box" style="margin-top: 20px;">
                <input type="text" id="employeeSearch" placeholder="ğŸ” ì§ì› ê²€ìƒ‰ (ì„±ëª…, ì´ë©”ì¼, ì „í™”ë²ˆí˜¸)" onkeyup="searchEmployees()">
            </div>

            <div class="table-container">
                <table id="employeesTable">
                    <thead>
                        <tr>
                            <th>ì„±ëª…</th>
                            <th>ì„±ë³„</th>
                            <th>ì „í™”ë²ˆí˜¸</th>
                            <th>ì´ë©”ì¼</th>
                            <th>ìê²©ì¦ ìˆ˜</th>
                            <th>ì…ì‚¬ì¼</th>
                            <th>ìƒíƒœ</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody id="employeesTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- ì—°ì°¨ê´€ë¦¬ -->
        <div id="annual-leave" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2c3e50;">ğŸ“… ì—°ì°¨ê´€ë¦¬</h2>
            <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <label style="font-weight: 600; color: #2c3e50;">íšŒê³„ë…„ë„:</label>
                    <input type="number" id="fiscalYear" value="2026" min="2020" max="2100" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; width: 100px;">
                </div>
                <button class="btn btn-primary" onclick="calculateAllAnnualLeave()">ğŸ”„ ì—°ì°¨ ì¬ê³„ì‚°</button>
                <button class="btn btn-success" onclick="openBulkLeaveModal()">ğŸ“‹ ì§ì› ì¼ê´„ì—°ì°¨</button>
                <span style="color: #7f8c8d; font-size: 0.9em;">â€» íšŒê³„ë…„ë„ ê¸°ì¤€(12ì›” 31ì¼)ìœ¼ë¡œ ì—°ì°¨ê°€ ê³„ì‚°ë©ë‹ˆë‹¤.</span>
            </div>
            
            <div class="table-container" style="margin-top: 20px;">
                <table id="annualLeaveTable">
                    <thead>
                        <tr>
                            <th>ì„±ëª…</th>
                            <th>ì…ì‚¬ì¼</th>
                            <th>ê·¼ì†ì—°ìˆ˜</th>
                            <th>ì´ ì—°ì°¨</th>
                            <th>ì‚¬ìš© ì—°ì°¨</th>
                            <th>ì”ì—¬ ì—°ì°¨</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody id="annualLeaveTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- ì§ë¬´êµìœ¡ -->
        <div id="education" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2c3e50;">ğŸ“š ì§ë¬´êµìœ¡</h2>
            <p style="color: #7f8c8d; margin-bottom: 20px;">â€» ì§ì›ì •ë³´ì˜ ìê²©ì¦ êµìœ¡ì¼ì— ë”°ë¼ ìë™ìœ¼ë¡œ êµìœ¡ì¼ì •ì´ ë“±ë¡ë©ë‹ˆë‹¤.</p>

            <div class="table-container">
                <table id="educationTable">
                    <thead>
                        <tr>
                            <th>ì„±ëª…</th>
                            <th>ìê²©ì¦</th>
                            <th>ì·¨ë“ì¼</th>
                            <th>êµìœ¡ìœ í˜•</th>
                            <th>êµìœ¡ì¼ì •</th>
                            <th>D-Day</th>
                            <th>ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody id="educationTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- ë°±ì—…ê´€ë¦¬ -->
        <div id="backup" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #2c3e50;">âš™ï¸ ë°±ì—…ê´€ë¦¬</h2>
            
            <div class="backup-info">
                <h3>ğŸ’¾ ë°±ì—… ë‹¤ìš´ë¡œë“œ</h3>
                <p>â€¢ í˜„ì¬ ì €ì¥ëœ ëª¨ë“  ë°ì´í„°ë¥¼ JSON íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.</p>
                <p>â€¢ íŒŒì¼ëª…ì— í˜„ì¬ ë‚ ì§œê°€ ìë™ìœ¼ë¡œ í¬í•¨ë©ë‹ˆë‹¤.</p>
                <p>â€¢ ì§ì›ì •ë³´, ì—°ì°¨ì •ë³´, êµìœ¡ì¼ì •ì´ ëª¨ë‘ í¬í•¨ë©ë‹ˆë‹¤.</p>
                <button class="btn btn-primary" onclick="downloadBackup()" style="margin-top: 10px;">
                    ğŸ’¾ ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                </button>
            </div>

            <div class="backup-info" style="background: #f0f8e8; border-left-color: #27ae60;">
                <h3>ğŸ“‚ ë°±ì—… ë¶ˆëŸ¬ì˜¤ê¸°</h3>
                <p>â€¢ ì´ì „ì— ë‹¤ìš´ë¡œë“œí•œ ë°±ì—… íŒŒì¼ì„ ì„ íƒí•˜ì—¬ ë°ì´í„°ë¥¼ ë³µì›í•©ë‹ˆë‹¤.</p>
                <p>â€¢ <strong style="color: #e74c3c;">âš ï¸ ì£¼ì˜: í˜„ì¬ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë˜ê³  ë°±ì—… íŒŒì¼ì˜ ë°ì´í„°ë¡œ êµì²´ë©ë‹ˆë‹¤.</strong></p>
                <p>â€¢ ë°±ì—… íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ê¸° ì „ì— í˜„ì¬ ë°ì´í„°ë¥¼ ë°±ì—…í•´ë‘ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
                <div class="file-input-wrapper" style="margin-top: 10px;">
                    <input type="file" id="restoreFileInput2" accept=".json" onchange="restoreBackup(event)">
                    <label for="restoreFileInput2" class="file-input-label">
                        ğŸ“‚ ë°±ì—… íŒŒì¼ ì„ íƒ
                    </label>
                    <span id="fileInputName"></span>
                </div>
            </div>

            <div class="info-section" style="margin-top: 30px;">
                <h3>ğŸ“Š í˜„ì¬ ë°ì´í„° í˜„í™©</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <label>ì „ì²´ ì§ì›</label>
                        <div class="value" id="backupEmployeeCount">0ëª…</div>
                    </div>
                    <div class="info-item">
                        <label>ì—°ì°¨ ë°ì´í„°</label>
                        <div class="value" id="backupLeaveCount">0ê±´</div>
                    </div>
                    <div class="info-item">
                        <label>êµìœ¡ ì¼ì •</label>
                        <div class="value" id="backupEducationCount">0ê±´</div>
                    </div>
                    <div class="info-item">
                        <label>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</label>
                        <div class="value" id="lastUpdate">-</div>
                    </div>
                </div>
            </div>

        <!-- ê´€ë¦¬ì íŒ¨ë„ -->
        <div id="admin" class="tab-content">
            <h2 style="margin-bottom:20px;color:#2c3e50;">ğŸ›¡ï¸ ê´€ë¦¬ì íŒ¨ë„</h2>
            <div class="pending-users-section">
                <h3>â³ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ íšŒì›</h3>
                <div id="pendingUsersList"><p style="color:#856404;font-style:italic;">ëŒ€ê¸° ì¤‘ì¸ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>
            </div>
            <div class="admin-settings-section">
                <h3 style="color:#2c3e50;margin-bottom:15px;">ğŸ‘¥ ì „ì²´ íšŒì› ëª©ë¡</h3>
                <div id="allUsersList"></div>
            </div>
            <div class="admin-settings-section">
                <h3 style="color:#2c3e50;margin-bottom:15px;">ğŸ”‘ ê´€ë¦¬ì ê³„ì • ì„¤ì •</h3>
                <div class="form-row">
                    <div class="form-group"><label>ìƒˆ ê´€ë¦¬ì ì•„ì´ë””</label><input type="text" id="newAdminId" placeholder="ë³€ê²½í•  ì•„ì´ë””"></div>
                    <div class="form-group"><label>í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label><input type="password" id="currentAdminPw" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>ìƒˆ ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="newAdminPw" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)"></div>
                    <div class="form-group"><label>ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label><input type="password" id="newAdminPw2" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥"></div>
                </div>
                <button class="btn btn-primary" onclick="updateAdminAccount()">ê´€ë¦¬ì ê³„ì • ì—…ë°ì´íŠ¸</button>
            </div>
        </div>
    </div><!-- /container -->

    <!-- ì§ì› ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-modal" onclick="closeEmployeeModal()">&times;</span>
                <h2 id="employeeModalTitle">ì§ì› ë“±ë¡</h2>
            </div>
            <form onsubmit="saveEmployee(event)">
                <input type="hidden" id="employeeId">
                
                <h3 style="color: #2c3e50; margin-bottom: 15px;">ê¸°ë³¸ ì •ë³´</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>ì„±ëª… *</label>
                        <input type="text" id="employeeName" required>
                    </div>
                    <div class="form-group">
                        <label>ì„±ë³„ *</label>
                        <select id="employeeGender" required>
                            <option value="">ì„ íƒ</option>
                            <option value="ë‚¨">ë‚¨</option>
                            <option value="ì—¬">ì—¬</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ì£¼ì†Œ</label>
                    <input type="text" id="employeeAddress">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" id="employeePhone">
                    </div>
                    <div class="form-group">
                        <label>ì´ë©”ì¼</label>
                        <input type="email" id="employeeEmail">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ì…ì‚¬ì¼ *</label>
                        <input type="date" id="employeeHireDate" required>
                    </div>
                    <div class="form-group">
                        <label>í‡´ì‚¬ì¼</label>
                        <input type="date" id="employeeResignDate">
                    </div>
                </div>

                <h3 style="color: #2c3e50; margin-top: 30px; margin-bottom: 15px;">ìê²©ì¦ ì •ë³´</h3>
                <div id="certificatesContainer"></div>
                <button type="button" class="add-certificate-btn" onclick="addCertificateField()">+ ìê²©ì¦ ì¶”ê°€</button>

                <div style="margin-top: 30px;">
                    <button type="submit" class="btn btn-primary">ì €ì¥</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEmployeeModal()">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì§ì› ìƒì„¸ì •ë³´ ëª¨ë‹¬ -->
    <div id="employeeDetailModal" class="modal">
        <div class="modal-content detail-modal">
            <div class="modal-header">
                <span class="close-modal" onclick="closeEmployeeDetailModal()">&times;</span>
                <h2>ì§ì› ìƒì„¸ì •ë³´</h2>
            </div>
            <div id="employeeDetailContent"></div>
        </div>
    </div>

    <!-- ì—°ì°¨ ì‚¬ìš© ëª¨ë‹¬ -->
    <div id="annualLeaveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-modal" onclick="closeAnnualLeaveModal()">&times;</span>
                <h2>ì—°ì°¨ ì‚¬ìš© ë“±ë¡</h2>
            </div>
            <form onsubmit="saveAnnualLeaveUsage(event)">
                <input type="hidden" id="leaveEmployeeId">
                
                <div class="form-group">
                    <label>ì§ì›ëª…</label>
                    <input type="text" id="leaveEmployeeName" readonly style="background: #f8f9fa;">
                </div>
                
                <div class="info-section">
                    <h3>ì—°ì°¨ í˜„í™©</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>ì´ ì—°ì°¨</label>
                            <div class="value"><span id="leaveTotalDays">0</span>ì¼</div>
                        </div>
                        <div class="info-item">
                            <label>ì‚¬ìš© ì—°ì°¨</label>
                            <div class="value"><span id="leaveUsedDays">0</span>ì¼</div>
                        </div>
                        <div class="info-item">
                            <label>ì”ì—¬ ì—°ì°¨</label>
                            <div class="value" style="color: #27ae60;"><span id="leaveRemainingDays">0</span>ì¼</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ì‚¬ìš© ì¼ìˆ˜ *</label>
                        <input type="number" id="leaveUsageDays" min="0.5" step="0.5" required>
                    </div>
                    <div class="form-group">
                        <label>ì‚¬ìš© ë‚ ì§œ *</label>
                        <input type="date" id="leaveUsageDate" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ì‚¬ìœ </label>
                    <textarea id="leaveUsageReason" rows="3"></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary">ë“±ë¡</button>
                <button type="button" class="btn btn-secondary" onclick="closeAnnualLeaveModal()">ì·¨ì†Œ</button>
            </form>
        </div>
    </div>

    <!-- ì—°ì°¨ ì‚¬ìš©ë‚´ì—­ ëª¨ë‹¬ -->
    <div id="annualLeaveHistoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-modal" onclick="closeAnnualLeaveHistoryModal()">&times;</span>
                <h2>ì—°ì°¨ ì‚¬ìš©ë‚´ì—­</h2>
            </div>
            <div id="annualLeaveHistoryContent"></div>
        </div>
    </div>

    <!-- ì§ì› ì¼ê´„ì—°ì°¨ ëª¨ë‹¬ -->
    <div id="bulkLeaveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-modal" onclick="closeBulkLeaveModal()">&times;</span>
                <h2>ì§ì› ì¼ê´„ì—°ì°¨ ì‚¬ìš©</h2>
            </div>
            <form onsubmit="saveBulkLeave(event)">
                <div class="backup-info" style="background: #fff3cd; border-left-color: #ffc107;">
                    <h3>âš ï¸ ì£¼ì˜ì‚¬í•­</h3>
                    <p>â€¢ ì¬ì§ ì¤‘ì¸ ëª¨ë“  ì§ì›ì—ê²Œ ë™ì¼í•œ ì—°ì°¨ê°€ ì°¨ê°ë©ë‹ˆë‹¤.</p>
                    <p>â€¢ ì”ì—¬ ì—°ì°¨ê°€ ë¶€ì¡±í•œ ì§ì›ì€ ìë™ìœ¼ë¡œ ì œì™¸ë©ë‹ˆë‹¤.</p>
                    <p>â€¢ ì¼ê´„ ì—°ì°¨ëŠ” ê°œë³„ ì‚¬ìš©ë‚´ì—­ì— ê¸°ë¡ë©ë‹ˆë‹¤.</p>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ì‚¬ìš© ì¼ìˆ˜ *</label>
                        <input type="number" id="bulkLeaveDays" min="0.5" step="0.5" required>
                    </div>
                    <div class="form-group">
                        <label>ì‚¬ìš© ë‚ ì§œ *</label>
                        <input type="date" id="bulkLeaveDate" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ì‚¬ìœ </label>
                    <textarea id="bulkLeaveReason" rows="3" placeholder="ì˜ˆ: íšŒì‚¬ íœ´ë¬´ì¼, êµ­ê²½ì¼ ëŒ€ì²´íœ´ë¬´ë“±"></textarea>
                </div>
                
                <div id="bulkLeavePreview" style="margin-top: 20px;"></div>
                
                <button type="submit" class="btn btn-success">ì¼ê´„ ì ìš©</button>
                <button type="button" class="btn btn-secondary" onclick="closeBulkLeaveModal()">ì·¨ì†Œ</button>
            </form>
        </div>
    </div>

    <script>
        /* =====================================================
           Firebase Firestore REST API ë°©ì‹ (SDK ë¶ˆí•„ìš”)
           CDN ì°¨ë‹¨ ë¬¸ì œ ì™„ì „ í•´ê²°
           ===================================================== */
        const FB_PROJECT = "sangwon-hrm";
        const FB_API_KEY = "AIzaSyBebDpB0eFP2yDZ4NK6K8IoWS8aTseHkzc";
        const FB_BASE    = `https://firestore.googleapis.com/v1/projects/${FB_PROJECT}/databases/(default)/documents`;

        // â”€â”€ Firestore REST í—¬í¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        // JS ê°’ â†’ Firestore í•„ë“œê°’ í˜•ì‹ ë³€í™˜
        function toFsValue(val) {
            if (val === null || val === undefined) return { nullValue: null };
            if (typeof val === 'boolean')  return { booleanValue: val };
            if (typeof val === 'number')   return Number.isInteger(val) ? { integerValue: String(val) } : { doubleValue: val };
            if (typeof val === 'string')   return { stringValue: val };
            if (Array.isArray(val))        return { arrayValue: { values: val.map(toFsValue) } };
            if (typeof val === 'object')   return { mapValue: { fields: toFsFields(val) } };
            return { stringValue: String(val) };
        }
        function toFsFields(obj) {
            const fields = {};
            for (const [k, v] of Object.entries(obj)) fields[k] = toFsValue(v);
            return fields;
        }

        // Firestore í•„ë“œê°’ â†’ JS ê°’ ë³€í™˜
        function fromFsValue(fv) {
            if (!fv) return null;
            if ('nullValue'    in fv) return null;
            if ('booleanValue' in fv) return fv.booleanValue;
            if ('integerValue' in fv) return Number(fv.integerValue);
            if ('doubleValue'  in fv) return fv.doubleValue;
            if ('stringValue'  in fv) return fv.stringValue;
            if ('arrayValue'   in fv) return (fv.arrayValue.values || []).map(fromFsValue);
            if ('mapValue'     in fv) return fromFsFields(fv.mapValue.fields || {});
            return null;
        }
        function fromFsFields(fields) {
            const obj = {};
            for (const [k, v] of Object.entries(fields)) obj[k] = fromFsValue(v);
            return obj;
        }

        // ì»¬ë ‰ì…˜ ì „ì²´ ì½ê¸°
        async function fsGetAll(col) {
            const res  = await fetch(`${FB_BASE}/${col}?key=${FB_API_KEY}`);
            const json = await res.json();
            if (!json.documents) return [];
            return json.documents.map(d => fromFsFields(d.fields || {}));
        }

        // ë¬¸ì„œ ì €ì¥ (upsert)
        async function fsSet(col, id, data) {
            const fields = toFsFields(JSON.parse(JSON.stringify(data)));
            await fetch(`${FB_BASE}/${col}/${id}?key=${FB_API_KEY}`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ fields })
            });
        }

        // ë¬¸ì„œ ì‚­ì œ
        async function fsDelete(col, id) {
            await fetch(`${FB_BASE}/${col}/${id}?key=${FB_API_KEY}`, { method: 'DELETE' });
        }

        // ì»¬ë ‰ì…˜ ì „ì²´ êµì²´
        async function fsReplaceAll(col, arr) {
            const existing = await fetch(`${FB_BASE}/${col}?key=${FB_API_KEY}`);
            const exJson   = await existing.json();
            if (exJson.documents) {
                await Promise.all(exJson.documents.map(d => {
                    const docId = d.name.split('/').pop();
                    return fetch(`${FB_BASE}/${col}/${docId}?key=${FB_API_KEY}`, { method: 'DELETE' });
                }));
            }
            await Promise.all(arr.map(item => {
                const id = String(item.id || item.employeeId || (Date.now()+Math.random()));
                return fsSet(col, id, item);
            }));
        }

        // ì „ì—­ ë…¸ì¶œ
        window.fbSet       = fsSet;
        window.fbDelete    = fsDelete;
        window.fbReplaceAll= fsReplaceAll;

        // â”€â”€ í´ë§ ê¸°ë°˜ ì‹¤ì‹œê°„ ë™ê¸°í™” (3ì´ˆë§ˆë‹¤ ê°±ì‹ ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function pollCollection(col, onUpdate) {
            const data = await fsGetAll(col);
            onUpdate(data);
        }

        function startPolling() {
            const poll = async () => {
                await pollCollection('employees',    d => { window._employees    = d; if(window._appReady){ updateDashboard(); loadEmployees(); loadAnnualLeave(); updateBackupInfo(); }});
                await pollCollection('annualLeaves', d => { window._annualLeaves = d; if(window._appReady){ loadAnnualLeave(); updateBackupInfo(); }});
                await pollCollection('educations',   d => { window._educations   = d; if(window._appReady){ loadEducation(); }});
                await pollCollection('sysUsers',     d => {
                    window._sysUsers = d;
                    if(window._appReady){
                        const cu = sessionStorage.getItem('currentUser');
                        if(cu && JSON.parse(cu).role === 'admin') loadAdminPanel();
                    }
                });
            };
            poll(); // ì¦‰ì‹œ 1íšŒ ì‹¤í–‰
            setInterval(poll, 5000); // 5ì´ˆë§ˆë‹¤ ê°±ì‹ 
        }

        // â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        window._employees    = [];
        window._annualLeaves = [];
        window._educations   = [];
        window._sysUsers     = [];
        window._appReady     = false;

        const _prop = (key) => ({ get(){ return window[key]; }, set(v){ window[key]=v; }, configurable:true });
        Object.defineProperty(window,'employees',    _prop('_employees'));
        Object.defineProperty(window,'annualLeaves', _prop('_annualLeaves'));
        Object.defineProperty(window,'educations',   _prop('_educations'));

        document.addEventListener('DOMContentLoaded', async () => {
            const fyInput = document.getElementById('fiscalYear');
            if(fyInput && !fyInput.value) fyInput.value = new Date().getFullYear();

            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
            await Promise.all([
                pollCollection('employees',    d => window._employees    = d),
                pollCollection('annualLeaves', d => window._annualLeaves = d),
                pollCollection('educations',   d => window._educations   = d),
                pollCollection('sysUsers',     d => window._sysUsers     = d),
            ]);

            // ê´€ë¦¬ì ê³„ì • ì´ˆê¸° ìƒì„±
            if(!window._sysUsers.find(u => u.role === 'admin')){
                await fsSet('sysUsers', 'admin', {
                    id:'admin', pw:'admin1234', name:'ê´€ë¦¬ì',
                    role:'admin', status:'approved', createdAt: new Date().toISOString()
                });
                window._sysUsers.push({ id:'admin', pw:'admin1234', name:'ê´€ë¦¬ì', role:'admin', status:'approved' });
            }

            window._appReady = true;
            updateDashboard(); loadEmployees(); loadAnnualLeave(); loadEducation(); updateBackupInfo();

            const cu = sessionStorage.getItem('currentUser');
            if(cu){
                document.getElementById('authOverlay').classList.remove('active');
                onLoginSuccess(JSON.parse(cu));
            }

            // í´ë§ ì‹œì‘ (5ì´ˆë§ˆë‹¤ ë‹¤ë¥¸ ê¸°ê¸° ë³€ê²½ì‚¬í•­ ë°˜ì˜)
            startPolling();
        });
    </script>

    <script>
        // â”€â”€ ì¸ì¦ ì‹œìŠ¤í…œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function getUsers(){ return window._sysUsers || []; }
        async function saveUser(user){
            await window.fbSet('sysUsers', user.id, user);
            // Firebase ë¦¬ìŠ¤ë„ˆ ëŒ€ê¸° ì—†ì´ ì¦‰ì‹œ ë©”ëª¨ë¦¬ ë°˜ì˜
            const idx = window._sysUsers.findIndex(u => u.id === user.id);
            if(idx >= 0) window._sysUsers[idx] = user;
            else window._sysUsers.push(user);
            // ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ëœ ê²½ìš° íŒ¨ë„ ì¦‰ì‹œ ê°±ì‹ 
            const cu = sessionStorage.getItem('currentUser');
            if(cu && JSON.parse(cu).role === 'admin') loadAdminPanel();
        }
        function getCurrentUser(){
            const s = sessionStorage.getItem('currentUser');
            return s ? JSON.parse(s) : null;
        }

        function switchAuthTab(tab){
            document.querySelectorAll('.auth-tab-btn').forEach((b,i)=>{
                b.classList.toggle('active',(i===0&&tab==='login')||(i===1&&tab==='register'));
            });
            document.getElementById('loginForm').classList.toggle('active',tab==='login');
            document.getElementById('registerForm').classList.toggle('active',tab==='register');
        }

        async function doLogin(){
            const id = document.getElementById('loginId').value.trim();
            const pw = document.getElementById('loginPw').value;
            const errEl = document.getElementById('loginError');
            if(!id||!pw){ errEl.textContent='ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'; errEl.classList.add('visible'); return; }

            const users = getUsers();
            const user  = users.find(u=>u.id===id && u.pw===pw);
            if(!user){ errEl.textContent='ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'; errEl.classList.add('visible'); return; }
            if(user.status==='pending'){ errEl.textContent='ê´€ë¦¬ì ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.'; errEl.classList.add('visible'); return; }
            if(user.status==='rejected'){ errEl.textContent='ê°€ì…ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.'; errEl.classList.add('visible'); return; }

            sessionStorage.setItem('currentUser', JSON.stringify(user));
            document.getElementById('authOverlay').classList.remove('active');
            onLoginSuccess(user);
        }

        async function doRegister(){
            const name=document.getElementById('regName').value.trim();
            const id=document.getElementById('regId').value.trim();
            const pw=document.getElementById('regPw').value;
            const pw2=document.getElementById('regPw2').value;
            const errEl=document.getElementById('registerError');
            const sucEl=document.getElementById('registerSuccess');
            errEl.classList.remove('visible'); sucEl.classList.remove('visible');

            if(!name||!id||!pw||!pw2){ errEl.textContent='ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.'; errEl.classList.add('visible'); return; }
            if(id.length<4){ errEl.textContent='ì•„ì´ë””ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'; errEl.classList.add('visible'); return; }
            if(pw.length<6){ errEl.textContent='ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'; errEl.classList.add('visible'); return; }
            if(pw!==pw2){ errEl.textContent='ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'; errEl.classList.add('visible'); return; }

            const users = getUsers();
            if(users.find(u=>u.id===id)){ errEl.textContent='ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.'; errEl.classList.add('visible'); return; }

            const newUser = { id, pw, name, role:'user', status:'pending', createdAt:new Date().toISOString() };
            await saveUser(newUser);
            sucEl.textContent='âœ… íšŒì›ê°€ì… ì‹ ì²­ ì™„ë£Œ! ê´€ë¦¬ì ìŠ¹ì¸ í›„ ë¡œê·¸ì¸í•˜ì„¸ìš”.';
            sucEl.classList.add('visible');
            ['regName','regId','regPw','regPw2'].forEach(x=>document.getElementById(x).value='');
        }

        function doLogout(){
            if(confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){ sessionStorage.removeItem('currentUser'); location.reload(); }
        }

        function onLoginSuccess(user){
            document.getElementById('headerUserName').textContent = user.name;
            const badge = document.getElementById('headerUserBadge');
            badge.textContent = user.role==='admin'?'ê´€ë¦¬ì':'ì¼ë°˜';
            badge.className = 'user-badge'+(user.role==='admin'?' admin':'');
            if(user.role==='admin'){
                document.getElementById('adminTab').style.display='';
                document.getElementById('annualLeaveTab').textContent='ğŸ“… ì—°ì°¨ê´€ë¦¬';
                loadAdminPanel();
            }
        }

        function showAnnualLeaveTab(){
            const user = getCurrentUser();
            if(!user || user.role!=='admin'){ alert('ğŸ”’ ì—°ì°¨ê´€ë¦¬ëŠ” ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'); return; }
            showTab('annual-leave', document.getElementById('annualLeaveTab'));
        }

        function loadAdminPanel(){
            const users   = getUsers();
            const pending = users.filter(u=>u.status==='pending');
            const pendingEl = document.getElementById('pendingUsersList');
            pendingEl.innerHTML = pending.length===0
                ? '<p style="color:#856404;font-style:italic;">ëŒ€ê¸° ì¤‘ì¸ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>'
                : pending.map(u=>`
                    <div class="pending-user-item">
                        <div><strong>${u.name}</strong> <span style="color:#7f8c8d;">(${u.id})</span>
                            <span style="font-size:.8em;color:#aaa;margin-left:8px;">${new Date(u.createdAt).toLocaleDateString('ko-KR')} ì‹ ì²­</span>
                        </div>
                        <div style="display:flex;gap:8px;">
                            <button class="btn btn-success btn-small" onclick="approveUser('${u.id}')">ìŠ¹ì¸</button>
                            <button class="btn btn-danger btn-small" onclick="rejectUser('${u.id}')">ê±°ì ˆ</button>
                        </div>
                    </div>`).join('');

            const allEl = document.getElementById('allUsersList');
            const all   = users.filter(u=>u.role!=='admin');
            allEl.innerHTML = all.length===0
                ? '<p style="color:#7f8c8d;font-style:italic;">ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>'
                : `<table style="width:100%;border-collapse:collapse;font-size:.9em;">
                    <thead style="background:#34495e;color:white;">
                        <tr><th style="padding:10px 12px;text-align:left;">ì´ë¦„</th><th style="padding:10px 12px;text-align:left;">ì•„ì´ë””</th>
                            <th style="padding:10px 12px;text-align:left;">ìƒíƒœ</th><th style="padding:10px 12px;text-align:left;">ê°€ì…ì¼</th>
                            <th style="padding:10px 12px;text-align:left;">ê´€ë¦¬</th></tr>
                    </thead>
                    <tbody>${all.map(u=>`
                        <tr style="border-bottom:1px solid #ecf0f1;">
                            <td style="padding:10px 12px;">${u.name}</td>
                            <td style="padding:10px 12px;">${u.id}</td>
                            <td style="padding:10px 12px;">
                                <span class="badge ${u.status==='approved'?'badge-success':u.status==='pending'?'badge-warning':'badge-danger'}">
                                    ${u.status==='approved'?'ìŠ¹ì¸ë¨':u.status==='pending'?'ëŒ€ê¸°ì¤‘':'ê±°ì ˆë¨'}
                                </span>
                            </td>
                            <td style="padding:10px 12px;color:#7f8c8d;">${new Date(u.createdAt).toLocaleDateString('ko-KR')}</td>
                            <td style="padding:10px 12px;">
                                ${u.status!=='approved'?`<button class="btn btn-success btn-small" onclick="approveUser('${u.id}')">ìŠ¹ì¸</button>`:''}
                                <button class="btn btn-danger btn-small" style="margin-left:4px;" onclick="deleteUser('${u.id}')">ì‚­ì œ</button>
                            </td>
                        </tr>`).join('')}
                    </tbody></table>`;
        }

        async function approveUser(userId){
            const users = getUsers();
            const u = users.find(u=>u.id===userId);
            if(u){ u.status='approved'; await saveUser(u); alert(`âœ… ${u.name}(${u.id}) íšŒì›ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`); }
        }
        async function rejectUser(userId){
            const users = getUsers();
            const u = users.find(u=>u.id===userId);
            if(u && confirm(`${u.name}(${u.id}) íšŒì› ê°€ì…ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){ u.status='rejected'; await saveUser(u); }
        }
        async function deleteUser(userId){
            const users = getUsers();
            const u = users.find(u=>u.id===userId);
            if(u && confirm(`${u.name}(${u.id}) íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){ await window.fbDelete('sysUsers', userId); }
        }

        async function updateAdminAccount(){
            const newId  = document.getElementById('newAdminId').value.trim();
            const curPw  = document.getElementById('currentAdminPw').value;
            const newPw  = document.getElementById('newAdminPw').value;
            const newPw2 = document.getElementById('newAdminPw2').value;
            const cu     = getCurrentUser();
            const users  = getUsers();
            const admin  = users.find(u=>u.id===cu.id && u.role==='admin');
            if(!admin){ alert('ê´€ë¦¬ì ê³„ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
            if(!curPw||admin.pw!==curPw){ alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
            if(newId&&newId.length<4){ alert('ì•„ì´ë””ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'); return; }
            if(newPw&&newPw.length<6){ alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'); return; }
            if(newPw&&newPw!==newPw2){ alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
            if(newId&&newId!==admin.id&&users.find(u=>u.id===newId)){ alert('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.'); return; }

            const oldId = admin.id;
            if(newId) admin.id = newId;
            if(newPw) admin.pw = newPw;

            if(oldId !== admin.id){
                await window.fbDelete('sysUsers', oldId);
            }
            await saveUser(admin);
            sessionStorage.setItem('currentUser', JSON.stringify(admin));
            document.getElementById('headerUserName').textContent = admin.name;
            ['newAdminId','currentAdminPw','newAdminPw','newAdminPw2'].forEach(x=>document.getElementById(x).value='');
            alert(`âœ… ê´€ë¦¬ì ê³„ì •ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.\nì•„ì´ë””: ${admin.id}`);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ë°±ì—… (ë‹¤ìš´ë¡œë“œ/ë³µì›)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function downloadBackup(){
            const today = new Date();
            const ds = today.getFullYear()+String(today.getMonth()+1).padStart(2,'0')+String(today.getDate()).padStart(2,'0')
                +'_'+String(today.getHours()).padStart(2,'0')+String(today.getMinutes()).padStart(2,'0');
            const data = { version:'2.0', backupDate:today.toISOString(), employees, annualLeaves, educations };
            const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `ì§ì›ê´€ë¦¬ì‹œìŠ¤í…œ_ë°±ì—…_${ds}.json`;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
            alert('âœ… ë°±ì—… íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function restoreBackup(event){
            const file = event.target.files[0];
            if(!file) return;
            const nameSpan = document.getElementById('fileInputName');
            if(nameSpan) nameSpan.textContent = file.name;
            if(!confirm('âš ï¸ ë°±ì—…ì„ ë³µì›í•˜ë©´ í˜„ì¬ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){ event.target.value=''; return; }
            const reader = new FileReader();
            reader.onload = async function(e){
                try{
                    const bd = JSON.parse(e.target.result);
                    if(!bd.employees||!Array.isArray(bd.employees)) throw new Error('ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.');

                    await window.fbReplaceAll('employees',    bd.employees);
                    await window.fbReplaceAll('annualLeaves', bd.annualLeaves||[]);
                    await window.fbReplaceAll('educations',   bd.educations||[]);

                    // ë©”ëª¨ë¦¬ ë°ì´í„° ì¦‰ì‹œ ë°˜ì˜ (Firebase ë¦¬ìŠ¤ë„ˆ ëŒ€ê¸° ì—†ì´ ë°”ë¡œ ê°±ì‹ )
                    window._employees    = bd.employees;
                    window._annualLeaves = bd.annualLeaves||[];
                    window._educations   = bd.educations||[];

                    updateDashboard();
                    loadEmployees();
                    loadAnnualLeave();
                    loadEducation();
                    updateBackupInfo();

                    alert(`âœ… ë°±ì—…ì´ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤!\nì§ì›: ${bd.employees.length}ëª…\në°±ì—…ì¼ì‹œ: ${new Date(bd.backupDate).toLocaleString('ko-KR')}`);
                } catch(err){ alert('âŒ ë³µì› ì‹¤íŒ¨: '+err.message); }
                event.target.value='';
                if(nameSpan) nameSpan.textContent='';
            };
            reader.readAsText(file);
        }

        function updateBackupInfo(){
            document.getElementById('backupEmployeeCount').textContent = employees.length+'ëª…';
            document.getElementById('backupLeaveCount').textContent    = annualLeaves.length+'ê±´';
            document.getElementById('backupEducationCount').textContent= educations.length+'ê±´';
            const lu = document.getElementById('lastUpdate');
            lu.textContent = (employees.length||annualLeaves.length||educations.length)
                ? new Date().toLocaleString('ko-KR') : 'ë°ì´í„° ì—†ìŒ';
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // íƒ­ ì „í™˜
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showTab(tabName, callerEl){
            document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            // í´ë¦­í•œ ë²„íŠ¼ ë˜ëŠ” í•´ë‹¹ íƒ­ ë²„íŠ¼ì„ active ì²˜ë¦¬
            const target = callerEl || (typeof event !== 'undefined' && event.target) || null;
            if(target && target.classList.contains('nav-tab')){
                target.classList.add('active');
            } else {
                // tabNameìœ¼ë¡œ í•´ë‹¹ nav-tab ë²„íŠ¼ ì°¾ì•„ì„œ active
                document.querySelectorAll('.nav-tab').forEach(t=>{
                    if(t.getAttribute('onclick') && t.getAttribute('onclick').includes(`'${tabName}'`)){
                        t.classList.add('active');
                    }
                });
            }
            if(tabName==='backup') updateBackupInfo();
            if(tabName==='admin')  loadAdminPanel();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ëŒ€ì‹œë³´ë“œ
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function updateDashboard(){
            const total  = employees.length;
            const active = employees.filter(e=>!e.resignDate||new Date(e.resignDate)>new Date()).length;
            const sixLater = new Date(); sixLater.setMonth(sixLater.getMonth()+6);
            const upcoming = educations.filter(e=>{ const d=new Date(e.educationDate); return d<=sixLater&&d>=new Date(); }).length;
            document.getElementById('totalEmployees').textContent   = total;
            document.getElementById('activeEmployees').textContent  = active;
            document.getElementById('inactiveEmployees').textContent= total-active;
            document.getElementById('upcomingEducation').textContent= upcoming;
        }

        function showAllEmployees(){ document.querySelector('[onclick="showTab(\'employees\')"]').click(); loadEmployees(); }
        function showActiveEmployees(){ document.querySelector('[onclick="showTab(\'employees\')"]').click(); renderEmployeeTable(employees.filter(e=>!e.resignDate||new Date(e.resignDate)>new Date())); }
        function showInactiveEmployees(){ document.querySelector('[onclick="showTab(\'employees\')"]').click(); renderEmployeeTable(employees.filter(e=>e.resignDate&&new Date(e.resignDate)<=new Date())); }
        function showUpcomingEducation(){ document.querySelector('[onclick="showTab(\'education\')"]').click(); }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ì§ì› ê´€ë¦¬
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let certificateCount = 0;

        function addCertificateField(certData=null){
            certificateCount++;
            const container = document.getElementById('certificatesContainer');
            const certId    = certData ? certData.id : Date.now()+certificateCount;
            const certDiv   = document.createElement('div');
            certDiv.className = 'certificate-item';
            certDiv.id = `cert-${certId}`;
            certDiv.innerHTML = `
                <button type="button" class="remove-certificate-btn" onclick="removeCertificateField('${certId}')">ì‚­ì œ</button>
                <h4>ìê²©ì¦ #${certificateCount}</h4>
                <div class="form-group"><label>ìê²©ì¦ëª…</label><input type="text" class="cert-name" value="${certData?certData.name:''}"></div>
                <div class="form-group"><label>ì·¨ë“ì¼</label><input type="date" class="cert-date" value="${certData?certData.date:''}"></div>
                <div class="education-dates">
                    <div class="education-date-item"><label>ì´ˆê¸‰êµìœ¡</label><input type="date" class="cert-edu-basic" value="${certData?.educationDates?.basic||''}"></div>
                    <div class="education-date-item"><label>ì¤‘ê¸‰êµìœ¡</label><input type="date" class="cert-edu-intermediate" value="${certData?.educationDates?.intermediate||''}"></div>
                    <div class="education-date-item"><label>ê³ ê¸‰êµìœ¡</label><input type="date" class="cert-edu-advanced" value="${certData?.educationDates?.advanced||''}"></div>
                    <div class="education-date-item"><label>íŠ¹ê¸‰êµìœ¡</label><input type="date" class="cert-edu-expert" value="${certData?.educationDates?.expert||''}"></div>
                    <div class="education-date-item"><label>í‰ê°€ì‚¬êµìœ¡</label><input type="date" class="cert-edu-evaluator" value="${certData?.educationDates?.evaluator||''}"></div>
                </div>`;
            container.appendChild(certDiv);
        }

        function removeCertificateField(certId){
            document.getElementById(`cert-${certId}`)?.remove();
        }

        function openEmployeeModal(employeeId=null){
            const modal = document.getElementById('employeeModal');
            document.getElementById('certificatesContainer').innerHTML='';
            certificateCount=0;
            if(employeeId){
                const emp = employees.find(e=>e.id===employeeId);
                document.getElementById('employeeModalTitle').textContent='ì§ì› ì •ë³´ ìˆ˜ì •';
                document.getElementById('employeeId').value      = emp.id;
                document.getElementById('employeeName').value    = emp.name;
                document.getElementById('employeeGender').value  = emp.gender;
                document.getElementById('employeeAddress').value = emp.address||'';
                document.getElementById('employeePhone').value   = emp.phone;
                document.getElementById('employeeEmail').value   = emp.email;
                document.getElementById('employeeHireDate').value   = emp.hireDate;
                document.getElementById('employeeResignDate').value = emp.resignDate||'';
                (emp.certificates&&emp.certificates.length ? emp.certificates : [null]).forEach(c=>addCertificateField(c));
            } else {
                document.getElementById('employeeModalTitle').textContent='ì§ì› ë“±ë¡';
                document.getElementById('employeeId').value='';
                document.querySelector('#employeeModal form').reset();
                addCertificateField();
            }
            modal.classList.add('active');
        }

        function closeEmployeeModal(){ document.getElementById('employeeModal').classList.remove('active'); }

        async function saveEmployee(event){
            event.preventDefault();
            const id = document.getElementById('employeeId').value;
            const certificates=[];
            document.querySelectorAll('.certificate-item').forEach(cd=>{
                const name=cd.querySelector('.cert-name').value;
                const date=cd.querySelector('.cert-date').value;
                if(name&&date) certificates.push({
                    id: cd.id.replace('cert-',''), name, date,
                    educationDates:{
                        basic:       cd.querySelector('.cert-edu-basic').value,
                        intermediate:cd.querySelector('.cert-edu-intermediate').value,
                        advanced:    cd.querySelector('.cert-edu-advanced').value,
                        expert:      cd.querySelector('.cert-edu-expert').value,
                        evaluator:   cd.querySelector('.cert-edu-evaluator').value
                    }
                });
            });

            const employee = {
                id:         id ? parseInt(id) : Date.now(),
                name:       document.getElementById('employeeName').value,
                gender:     document.getElementById('employeeGender').value,
                address:    document.getElementById('employeeAddress').value,
                phone:      document.getElementById('employeePhone').value,
                email:      document.getElementById('employeeEmail').value,
                hireDate:   document.getElementById('employeeHireDate').value,
                resignDate: document.getElementById('employeeResignDate').value,
                certificates
            };

            // ê¸°ì¡´ êµìœ¡ ì‚­ì œ í›„ ì¬ìƒì„±
            const oldEdus = educations.filter(e=>e.employeeId===employee.id);
            for(const edu of oldEdus) await window.fbDelete('educations', edu.id);

            if(id){
                const idx = employees.findIndex(e=>e.id===parseInt(id));
                employees[idx]=employee;
            } else {
                employees.push(employee);
                calculateAnnualLeaveForEmployee(employee);
            }

            generateEducationSchedule(employee);

            // Firebase ì €ì¥
            await window.fbSet('employees', employee.id, employee);
            for(const edu of educations.filter(e=>e.employeeId===employee.id)){
                await window.fbSet('educations', edu.id, edu);
            }
            const leaveData = annualLeaves.find(a=>a.employeeId===employee.id);
            if(leaveData) await window.fbSet('annualLeaves', leaveData.employeeId, leaveData);

            closeEmployeeModal();
            alert('ì§ì› ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function generateEducationSchedule(employee){
            if(!employee.certificates) return;
            const eduTypes=[{key:'basic',name:'ì´ˆê¸‰êµìœ¡'},{key:'intermediate',name:'ì¤‘ê¸‰êµìœ¡'},
                {key:'advanced',name:'ê³ ê¸‰êµìœ¡'},{key:'expert',name:'íŠ¹ê¸‰êµìœ¡'},{key:'evaluator',name:'í‰ê°€ì‚¬êµìœ¡'}];
            employee.certificates.forEach(cert=>{
                eduTypes.forEach(type=>{
                    const eduDate = cert.educationDates[type.key];
                    if(eduDate) educations.push({
                        id: Date.now()+Math.random(),
                        employeeId:employee.id, employeeName:employee.name,
                        certificate:cert.name, certificateDate:cert.date,
                        type:type.name, educationDate:eduDate
                    });
                });
            });
        }

        function renderEmployeeTable(list){
            const tbody = document.getElementById('employeesTableBody');
            if(!list.length){ tbody.innerHTML='<tr><td colspan="8" class="no-data">í‘œì‹œí•  ì§ì› ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>'; return; }
            tbody.innerHTML = list.map(emp=>{
                const isActive = !emp.resignDate||new Date(emp.resignDate)>new Date();
                const certCount= emp.certificates?emp.certificates.length:0;
                return `<tr>
                    <td>${emp.name}</td><td>${emp.gender}</td><td>${emp.phone}</td><td>${emp.email}</td>
                    <td><span class="badge badge-info">${certCount}ê°œ</span></td>
                    <td>${new Date(emp.hireDate).toLocaleDateString('ko-KR')}</td>
                    <td><span class="badge ${isActive?'badge-success':'badge-danger'}">${isActive?'ì¬ì§':'í‡´ì‚¬'}</span></td>
                    <td><div class="action-buttons">
                        <button class="btn btn-info btn-small" onclick="showEmployeeDetail(${emp.id})">ìƒì„¸</button>
                        <button class="btn btn-primary btn-small" onclick="openEmployeeModal(${emp.id})">ìˆ˜ì •</button>
                        <button class="btn btn-danger btn-small" onclick="deleteEmployee(${emp.id})">ì‚­ì œ</button>
                    </div></td></tr>`;
            }).join('');
        }

        function loadEmployees(){ renderEmployeeTable(employees); }

        function searchEmployees(){
            const s = document.getElementById('employeeSearch').value.toLowerCase();
            renderEmployeeTable(employees.filter(e=>
                e.name.toLowerCase().includes(s)||e.email.toLowerCase().includes(s)||e.phone.includes(s)
            ));
        }

        function showEmployeeDetail(empId){
            const emp = employees.find(e=>e.id===empId);
            const isActive = !emp.resignDate||new Date(emp.resignDate)>new Date();
            const eduTypes=[{key:'basic',name:'ì´ˆê¸‰êµìœ¡'},{key:'intermediate',name:'ì¤‘ê¸‰êµìœ¡'},
                {key:'advanced',name:'ê³ ê¸‰êµìœ¡'},{key:'expert',name:'íŠ¹ê¸‰êµìœ¡'},{key:'evaluator',name:'í‰ê°€ì‚¬êµìœ¡'}];
            let certsHtml = '<p class="no-data">ë“±ë¡ëœ ìê²©ì¦ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            if(emp.certificates&&emp.certificates.length){
                certsHtml = emp.certificates.map(cert=>{
                    let eduHtml='';
                    eduTypes.forEach(type=>{ if(cert.educationDates[type.key]) eduHtml+=`
                        <div class="info-item"><label>${type.name}</label>
                            <div class="value">${new Date(cert.educationDates[type.key]).toLocaleDateString('ko-KR')}</div></div>`; });
                    return `<div class="certificate-item"><h4>ğŸ“œ ${cert.name}</h4>
                        <p style="color:#7f8c8d;margin-bottom:10px;">ì·¨ë“ì¼: ${new Date(cert.date).toLocaleDateString('ko-KR')}</p>
                        ${eduHtml?`<div class="education-grid">${eduHtml}</div>`:'<p style="color:#7f8c8d;font-size:.9em;">êµìœ¡ì¼ì • ì—†ìŒ</p>'}
                    </div>`;
                }).join('');
            }
            document.getElementById('employeeDetailContent').innerHTML=`
                <div class="info-section"><h3>ê¸°ë³¸ ì •ë³´</h3><div class="info-grid">
                    <div class="info-item"><label>ì„±ëª…</label><div class="value">${emp.name}</div></div>
                    <div class="info-item"><label>ì„±ë³„</label><div class="value">${emp.gender}</div></div>
                    <div class="info-item"><label>ì „í™”ë²ˆí˜¸</label><div class="value">${emp.phone}</div></div>
                    <div class="info-item"><label>ì´ë©”ì¼</label><div class="value">${emp.email}</div></div>
                    <div class="info-item"><label>ì…ì‚¬ì¼</label><div class="value">${new Date(emp.hireDate).toLocaleDateString('ko-KR')}</div></div>
                    <div class="info-item"><label>ìƒíƒœ</label><div class="value">
                        <span class="badge ${isActive?'badge-success':'badge-danger'}">${isActive?'ì¬ì§':'í‡´ì‚¬'}</span>
                    </div></div>
                </div>${emp.address?`<div class="info-item" style="margin-top:15px;"><label>ì£¼ì†Œ</label><div class="value">${emp.address}</div></div>`:''}</div>
                <div class="info-section"><h3>ìê²©ì¦ ì •ë³´</h3>${certsHtml}</div>`;
            document.getElementById('employeeDetailModal').classList.add('active');
        }

        function closeEmployeeDetailModal(){ document.getElementById('employeeDetailModal').classList.remove('active'); }

        async function deleteEmployee(id){
            if(!confirm('ì´ ì§ì› ì •ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì—°ì°¨ ë° êµìœ¡ ë°ì´í„°ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤)')) return;
            const eduToDelete = educations.filter(e=>e.employeeId===id);
            await window.fbDelete('employees',    id);
            await window.fbDelete('annualLeaves', id);
            for(const edu of eduToDelete) await window.fbDelete('educations', edu.id);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ì—°ì°¨ ê´€ë¦¬
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function calculateAnnualLeaveForEmployee(employee){
            const hireDate   = new Date(employee.hireDate);
            const fiscalYear = parseInt(document.getElementById('fiscalYear').value)||new Date().getFullYear();
            const fiscalEnd  = new Date(fiscalYear,11,31);
            const yos        = (fiscalEnd-hireDate)/(365.25*24*60*60*1000);
            let totalDays    = yos<1 ? 12 : Math.min(15+(yos>=3?Math.floor((yos-1)/2):0),25);

            const existing = annualLeaves.find(a=>a.employeeId===employee.id);
            if(existing){ existing.totalDays=totalDays; existing.yearsOfService=yos.toFixed(1); existing.fiscalYear=fiscalYear; }
            else annualLeaves.push({ employeeId:employee.id, totalDays, usedDays:0, yearsOfService:yos.toFixed(1), fiscalYear, usageHistory:[] });
        }

        async function calculateAllAnnualLeave(){
            const fy = document.getElementById('fiscalYear').value;
            if(!fy){ alert('íšŒê³„ë…„ë„ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            if(!confirm(`${fy}ë…„ ê¸°ì¤€ìœ¼ë¡œ ì „ì²´ ì§ì›ì˜ ì—°ì°¨ë¥¼ ì¬ê³„ì‚°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            const active = employees.filter(e=>!e.resignDate||new Date(e.resignDate)>new Date());
            for(const emp of active){
                calculateAnnualLeaveForEmployee(emp);
                const ld = annualLeaves.find(a=>a.employeeId===emp.id);
                if(ld) await window.fbSet('annualLeaves', ld.employeeId, ld);
            }
            loadAnnualLeave(); updateBackupInfo();
            alert(`${fy}ë…„ íšŒê³„ë…„ë„ ê¸°ì¤€ìœ¼ë¡œ ì „ì²´ ì—°ì°¨ê°€ ì¬ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        function loadAnnualLeave(){
            const tbody = document.getElementById('annualLeaveTableBody');
            const active = employees.filter(e=>!e.resignDate||new Date(e.resignDate)>new Date());
            if(!active.length){ tbody.innerHTML='<tr><td colspan="7" class="no-data">ì¬ì§ ì¤‘ì¸ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>'; return; }
            tbody.innerHTML = active.map(emp=>{
                let leave = annualLeaves.find(a=>a.employeeId===emp.id);
                if(!leave){ calculateAnnualLeaveForEmployee(emp); leave=annualLeaves.find(a=>a.employeeId===emp.id); }
                const rem = leave.totalDays-leave.usedDays;
                return `<tr>
                    <td>${emp.name}</td>
                    <td>${new Date(emp.hireDate).toLocaleDateString('ko-KR')}</td>
                    <td>${leave.yearsOfService}ë…„</td>
                    <td>${leave.totalDays}ì¼</td>
                    <td>${leave.usedDays}ì¼</td>
                    <td><span class="badge ${rem>5?'badge-success':rem>0?'badge-warning':'badge-danger'}">${rem}ì¼</span></td>
                    <td><div class="action-buttons">
                        <button class="btn btn-primary btn-small" onclick="openAnnualLeaveModal(${emp.id})">ì—°ì°¨ì‚¬ìš©</button>
                        <button class="btn btn-info btn-small" onclick="showAnnualLeaveHistory(${emp.id})">ì‚¬ìš©ë‚´ì—­</button>
                    </div></td></tr>`;
            }).join('');
        }

        function openAnnualLeaveModal(empId){
            const emp   = employees.find(e=>e.id===empId);
            const leave = annualLeaves.find(a=>a.employeeId===empId);
            document.getElementById('leaveEmployeeId').value    = empId;
            document.getElementById('leaveEmployeeName').value  = emp.name;
            document.getElementById('leaveTotalDays').textContent    = leave.totalDays;
            document.getElementById('leaveUsedDays').textContent     = leave.usedDays;
            document.getElementById('leaveRemainingDays').textContent= leave.totalDays-leave.usedDays;
            document.getElementById('annualLeaveModal').classList.add('active');
        }

        function closeAnnualLeaveModal(){
            document.getElementById('annualLeaveModal').classList.remove('active');
            document.querySelector('#annualLeaveModal form').reset();
        }

        async function saveAnnualLeaveUsage(event){
            event.preventDefault();
            const empId    = parseInt(document.getElementById('leaveEmployeeId').value);
            const days     = parseFloat(document.getElementById('leaveUsageDays').value);
            const date     = document.getElementById('leaveUsageDate').value;
            const reason   = document.getElementById('leaveUsageReason').value;
            const leave    = annualLeaves.find(a=>a.employeeId===empId);
            const remaining= leave.totalDays-leave.usedDays;
            if(days>remaining){ alert(`ì‚¬ìš© ê°€ëŠ¥í•œ ì—°ì°¨ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (ì”ì—¬: ${remaining}ì¼)`); return; }
            leave.usedDays += days;
            leave.usageHistory = leave.usageHistory||[];
            leave.usageHistory.push({ date, days, reason, recordDate:new Date().toISOString() });
            await window.fbSet('annualLeaves', leave.employeeId, leave);
            closeAnnualLeaveModal();
            alert('ì—°ì°¨ ì‚¬ìš©ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function showAnnualLeaveHistory(empId){
            const emp   = employees.find(e=>e.id===empId);
            const leave = annualLeaves.find(a=>a.employeeId===empId);
            let html='<p class="no-data">ì—°ì°¨ ì‚¬ìš©ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            if(leave.usageHistory&&leave.usageHistory.length){
                const sorted=[...leave.usageHistory].sort((a,b)=>new Date(b.date)-new Date(a.date));
                html=`<div class="info-section"><h3>${emp.name} - ì—°ì°¨ í˜„í™©</h3><div class="info-grid">
                    <div class="info-item"><label>ì´ ì—°ì°¨</label><div class="value">${leave.totalDays}ì¼</div></div>
                    <div class="info-item"><label>ì‚¬ìš© ì—°ì°¨</label><div class="value">${leave.usedDays}ì¼</div></div>
                    <div class="info-item"><label>ì”ì—¬ ì—°ì°¨</label><div class="value" style="color:#27ae60;">${leave.totalDays-leave.usedDays}ì¼</div></div>
                </div></div>
                <div class="info-section"><h3>ì‚¬ìš© ë‚´ì—­</h3><div class="annual-leave-history">
                ${sorted.map((h,i)=>`
                    <div class="history-item">
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;">
                            <div><div class="date">ğŸ“… ${new Date(h.date).toLocaleDateString('ko-KR')}</div>
                                <div style="margin-top:5px;"><span class="days">${h.days}ì¼ ì‚¬ìš©</span>
                                    ${h.reason?`<span style="color:#7f8c8d;margin-left:10px;">- ${h.reason}</span>`:''}
                                </div>
                                <div style="margin-top:5px;font-size:.85em;color:#95a5a6;">ë“±ë¡ì¼: ${new Date(h.recordDate).toLocaleDateString('ko-KR')}</div>
                            </div>
                            <div style="display:flex;gap:5px;">
                                <button class="btn" style="padding:5px 10px;font-size:.85em;background:#3498db;color:white;" onclick="editLeaveHistory(${empId},${i})">ìˆ˜ì •</button>
                                <button class="btn" style="padding:5px 10px;font-size:.85em;background:#e74c3c;color:white;" onclick="deleteLeaveHistory(${empId},${i})">ì‚­ì œ</button>
                            </div>
                        </div>
                    </div>`).join('')}
                </div></div>`;
            }
            document.getElementById('annualLeaveHistoryContent').innerHTML=html;
            document.getElementById('annualLeaveHistoryModal').classList.add('active');
        }

        function closeAnnualLeaveHistoryModal(){ document.getElementById('annualLeaveHistoryModal').classList.remove('active'); }

        async function deleteLeaveHistory(empId, idx){
            if(!confirm('ì´ ì—°ì°¨ ì‚¬ìš© ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const leave = annualLeaves.find(a=>a.employeeId===empId);
            const sorted= [...leave.usageHistory].sort((a,b)=>new Date(b.date)-new Date(a.date));
            const target= sorted[idx];
            const realIdx= leave.usageHistory.indexOf(target);
            leave.usedDays -= target.days;
            leave.usageHistory.splice(realIdx,1);
            await window.fbSet('annualLeaves', leave.employeeId, leave);
            showAnnualLeaveHistory(empId);
            alert('ì—°ì°¨ ì‚¬ìš© ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        async function editLeaveHistory(empId, idx){
            const leave  = annualLeaves.find(a=>a.employeeId===empId);
            const sorted = [...leave.usageHistory].sort((a,b)=>new Date(b.date)-new Date(a.date));
            const target = sorted[idx];
            const realIdx= leave.usageHistory.indexOf(target);
            const newDate = prompt('ì‚¬ìš© ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš” (YYYY-MM-DD):', target.date);
            if(!newDate) return;
            if(!/^\d{4}-\d{2}-\d{2}$/.test(newDate)){ alert('ì˜¬ë°”ë¥¸ ë‚ ì§œ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.'); return; }
            const newDays = parseFloat(prompt('ì‚¬ìš© ì¼ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”:', target.days));
            if(isNaN(newDays)||newDays<=0){ alert('ì˜¬ë°”ë¥¸ ì¼ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
            const newReason = prompt('ì‚¬ìš© ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:', target.reason||'');
            const curUsed = leave.usedDays - target.days;
            if(curUsed+newDays > leave.totalDays){ alert(`ì”ì—¬ ì—°ì°¨ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.`); return; }
            leave.usedDays = curUsed + newDays;
            leave.usageHistory[realIdx] = { ...target, date:newDate, days:newDays, reason:newReason, modifiedDate:new Date().toISOString() };
            await window.fbSet('annualLeaves', leave.employeeId, leave);
            showAnnualLeaveHistory(empId);
            alert('ì—°ì°¨ ì‚¬ìš© ë‚´ì—­ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì¼ê´„ì—°ì°¨
        function openBulkLeaveModal(){
            if(!employees.filter(e=>!e.resignDate||new Date(e.resignDate)>new Date()).length){ alert('ì¬ì§ ì¤‘ì¸ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
            document.getElementById('bulkLeaveModal').classList.add('active');
            updateBulkLeavePreview();
        }
        function closeBulkLeaveModal(){
            document.getElementById('bulkLeaveModal').classList.remove('active');
            document.querySelector('#bulkLeaveModal form').reset();
            document.getElementById('bulkLeavePreview').innerHTML='';
        }
        function updateBulkLeavePreview(){
            const days=parseFloat(document.getElementById('bulkLeaveDays').value)||0;
            const active=employees.filter(e=>!e.resignDate||new Date(e.resignDate)>new Date());
            if(days<=0){ document.getElementById('bulkLeavePreview').innerHTML=''; return; }
            let ok=0, skip=0, skipList=[];
            active.forEach(emp=>{ const l=annualLeaves.find(a=>a.employeeId===emp.id); if(l){ const r=l.totalDays-l.usedDays; r>=days?ok++:(skip++,skipList.push(`${emp.name}(ì”ì—¬:${r}ì¼)`)); } });
            document.getElementById('bulkLeavePreview').innerHTML=`
                <div class="info-section"><h3>ì ìš© ëŒ€ìƒ ë¯¸ë¦¬ë³´ê¸°</h3><div class="info-grid">
                    <div class="info-item"><label>ì ìš© ëŒ€ìƒ</label><div class="value" style="color:#27ae60;">${ok}ëª…</div></div>
                    <div class="info-item"><label>ì œì™¸ ëŒ€ìƒ</label><div class="value" style="color:#e74c3c;">${skip}ëª…</div></div>
                    <div class="info-item"><label>ì‚¬ìš© ì¼ìˆ˜</label><div class="value">${days}ì¼</div></div>
                </div>${skip?`<div style="margin-top:15px;padding:10px;background:#f8d7da;border-radius:5px;border-left:3px solid #e74c3c;">
                    <strong>ì œì™¸ë˜ëŠ” ì§ì›:</strong><br><span style="color:#721c24;font-size:.9em;">${skipList.join(', ')}</span></div>`:''}
                </div>`;
        }
        document.addEventListener('DOMContentLoaded',()=>{
            document.getElementById('bulkLeaveDays')?.addEventListener('input', updateBulkLeavePreview);
        });
        async function saveBulkLeave(event){
            event.preventDefault();
            const days  = parseFloat(document.getElementById('bulkLeaveDays').value);
            const date  = document.getElementById('bulkLeaveDate').value;
            const reason= document.getElementById('bulkLeaveReason').value;
            if(!days||days<=0){ alert('ì‚¬ìš© ì¼ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            if(!date){ alert('ì‚¬ìš© ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
            const active=employees.filter(e=>!e.resignDate||new Date(e.resignDate)>new Date());
            let ok=0, skip=0, skipNames=[];
            for(const emp of active){
                const leave=annualLeaves.find(a=>a.employeeId===emp.id);
                if(leave){ const r=leave.totalDays-leave.usedDays;
                    if(r>=days){
                        leave.usedDays+=days; leave.usageHistory=leave.usageHistory||[];
                        leave.usageHistory.push({ date, days, reason:reason||'ì¼ê´„ ì—°ì°¨ ì‚¬ìš©', recordDate:new Date().toISOString(), isBulk:true });
                        await window.fbSet('annualLeaves', leave.employeeId, leave); ok++;
                    } else { skip++; skipNames.push(emp.name); }
                }
            }
            closeBulkLeaveModal();
            alert(`âœ… ì¼ê´„ì—°ì°¨ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.\nì ìš©: ${ok}ëª…${skip?`\nâš ï¸ ì œì™¸: ${skip}ëª… (${skipNames.join(', ')})`:''}`);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ì§ë¬´êµìœ¡
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function loadEducation(){
            const tbody = document.getElementById('educationTableBody');
            if(!educations.length){ tbody.innerHTML='<tr><td colspan="7" class="no-data">ë“±ë¡ëœ êµìœ¡ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>'; return; }
            const sorted=[...educations].sort((a,b)=>new Date(a.educationDate)-new Date(b.educationDate));
            tbody.innerHTML=sorted.map(edu=>{
                const diff=Math.ceil((new Date(edu.educationDate)-new Date())/(1000*60*60*24));
                let dday='', ddayClass='', status='', statusClass='';
                if(diff<0){dday='ì™„ë£Œ';ddayClass='badge-secondary';status='ì™„ë£Œ';statusClass='badge-secondary';}
                else if(diff===0){dday='D-Day';ddayClass='badge-danger';status='ë‹¹ì¼';statusClass='badge-danger';}
                else if(diff<=30){dday=`D-${diff}`;ddayClass='badge-warning';status='ì„ë°•';statusClass='badge-warning';}
                else if(diff<=180){dday=`D-${diff}`;ddayClass='badge-info';status='ì˜ˆì •';statusClass='badge-info';}
                else{dday=`D-${diff}`;ddayClass='badge-secondary';status='ì˜ˆì •';statusClass='badge-secondary';}
                return `<tr>
                    <td>${edu.employeeName}</td>
                    <td>${edu.certificate||'-'}</td>
                    <td>${edu.certificateDate?new Date(edu.certificateDate).toLocaleDateString('ko-KR'):'-'}</td>
                    <td><span class="badge badge-info">${edu.type}</span></td>
                    <td>${new Date(edu.educationDate).toLocaleDateString('ko-KR')}</td>
                    <td><span class="badge ${ddayClass}">${dday}</span></td>
                    <td><span class="badge ${statusClass}">${status}</span></td></tr>`;
            }).join('');
        }
    </script>
</body>
</html>
